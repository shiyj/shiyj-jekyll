<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>Tom Preston-Werner</title>
 <link href="http://tom.preston-werner.com/atom.xml" rel="self"/>
 <link href="http://tom.preston-werner.com/"/>
 <updated>2014-03-16T22:48:35+08:00</updated>
 <id>http://tom.preston-werner.com/</id>
 <author>
   <name>Tom Preston-Werner</name>
   <email>tom@mojombo.com</email>
 </author>

 
 <entry>
   <title>ruboto入门</title>
   <link href="http://tom.preston-werner.com/2014/03/15/start-ruboto.html"/>
   <updated>2014-03-15T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2014/03/15/start-ruboto</id>
   <content type="html">&lt;p&gt;使用ruboto可以在android上用Ruby开发android程序。&lt;br/&gt;
android开发一般使用JAVA，但是借助与JRuby，ruby代码是可以和java互通，这就是ruboto的实现基本思路。&lt;/p&gt;

&lt;p&gt;在开始使用ruboto之前，必须声明的是，ruboto并不是开发一个完美android程序的首选。&lt;br/&gt;
虽然我对JAVA没有多少好感，却不得不说在android的开发上，JAVA不管在性能还是文档支持上都有很大的优越性。ruboto和phonegap等这些看起来很酷的技术实际上都无法达到原生应用的性能。所以，如果性能是你考虑的问题，直接用JAVA来吧。&lt;br/&gt;
&amp;lt;!--break--&amp;gt;&lt;/p&gt;

&lt;h3&gt;环境配置：&lt;/h3&gt;

&lt;p&gt;ruboto 依赖JRuby&amp;amp;JDK（open jdk） 、android sdk，首先需要保证已经安装有这两个：&lt;br/&gt;
由于之前装有rvm，可以直接在rvm中install jruby。&lt;br/&gt;
不过，jruby放在了amazon s3服务器上，如果不设在代理是没法直接安装，&lt;br/&gt;
而在ubuntu下的代理工具一直没有比较好的，懒得折腾就直接在windows下用free，，，，gate下载一个，再切换会ubuntu。&lt;/p&gt;

&lt;p&gt;这时无法使用rvm，不过也无所谓了，rvm里边乱七八糟的弄不懂，还不如直接自己设在环境变量：&lt;/p&gt;

&lt;h4&gt;重置rvm，再将JRuby设在为默认&lt;/h4&gt;

&lt;p&gt;具体方法如下：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;rvm reset
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;export ANDROID_HOME=/home/engin/appstore/android-studio/android-studio/sdk
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;export PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/build-tools:$ANDROID_HOME/platform-tools
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;export JRUBY_HOME=/home/engin/appstore/jruby-1.7.10
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;export PATH=$PATH:$JRUBY_HOME/bin
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;echo $PATH
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;将上述代码保存为sh文件，每次在使用ruboto时打开终端，执行&lt;code&gt;. start_ruboto.sh&lt;/code&gt;就能在当前的终端中使用这个配置。&lt;/p&gt;

&lt;p&gt;*** 注意，&lt;code&gt;. start_ruboto.sh&lt;/code&gt;是一个点号加空格再加文件名称，这是表示在当前的终端执行脚本，脚本的内容就和直接输入的类似点号的作用和 &lt;code&gt;source&lt;/code&gt;  类似 ***&lt;/p&gt;

&lt;p&gt;之后就可以&lt;code&gt;gem install ruboto&lt;/code&gt;来安装这个gem。&lt;/p&gt;

&lt;h3&gt;创建一个android工程&lt;/h3&gt;

&lt;p&gt;ruboto 提供的工具集和rails类似：简化开发工作量，隐藏实现细节。&lt;br/&gt;
创建一个工程只需要如下代码即可为你生成一大堆的文件和代码：&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$ ruboto gen app --package com.yourdomain.whatever --path path/to/where/you/want/the/app --name NameOfApp --target android-version --min-sdk another-android-version --activity MainActivityName&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;好吧，这个代码有点烦人，如果你不想copy上边代码，简单点的只需要其中两个：&lt;code&gt;--package&lt;/code&gt;,&lt;code&gt;--target&lt;/code&gt;.&lt;br/&gt;
不过如果他默认生成的不合你的要求，你就要自己去&lt;code&gt;增加工作量&lt;/code&gt;，&lt;code&gt;实现隐藏的细节&lt;/code&gt;了。&lt;br/&gt;
简洁版的如下：&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$ ruboto gen app  --package com.geoinker.ruboto --target android-15&lt;/code&gt;&lt;br/&gt;
接着会在终端中现实一些实现细节，具体看你创建的文件夹下的内容吧。&lt;/p&gt;

&lt;h3&gt;编译生成&lt;/h3&gt;

&lt;p&gt;刚刚创建的那个demo会包含ruboto的一个小例子，直接编译就可以生成apk&lt;/p&gt;

&lt;p&gt;&lt;code&gt;rake install&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;rake 后边加上install表示和makd install差不多，如果没有生成apk就先生成apk然后install到android真机或者模拟器上。&lt;/p&gt;

&lt;p&gt;如果你在非eclipse下使用纯命令行开发过android程序的话应该明白实际上这句话执行的相当于：&lt;br/&gt;
&lt;code&gt;ant debug &amp;amp; adb install xxx.apk&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;当然rake后边还可以干很多事情，除了基本的debug、release、install之外，还有更新等操作，这些才是ruboto（ruby）的魅力。&lt;/p&gt;

&lt;p&gt;如果上述命令执行成功的话，你会看到这样的提示：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;-post-build:
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;debug:
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;BUILD SUCCESSFUL
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;Total time: 18 seconds
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;adb shell date -s 20140315.113441
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;Sat Mar 15 11:34:34 CST 2014
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;Installing package com.geoinker.ruboto
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;1403 KB/s (61606 bytes in 0.042s)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    pkg: /data/local/tmp/Ruboto-debug.apk
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;Success
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;OK,编译成功，并且也安装到我的手机上了。&lt;/p&gt;

&lt;h4&gt;可能的错误&lt;/h4&gt;

&lt;p&gt;不过别高兴太早，你很可能遇到这样的画面：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/start_ruboto/first_ruboto.png&quot; alt=&quot;第一次使用错误&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Welcome to Ruboto!  This is the first Ruboto application installed on this device.  To continue, you need to install the Ruboto Core platform package.&lt;/p&gt;

&lt;p&gt;其实从我们生成的apk的大小上就能看出一些端倪来：&lt;br/&gt;
根目录下的bin文件夹内有生成的apk文件，大小大概在60k左右（基本上是当前工程中所有代码文件的总和）；&lt;br/&gt;
而ruboto是借助JRuby来进行ruby代码与dalvik虚拟机的交流，此外ruboto还自己实现了一些常用Android UI的绑定。&lt;br/&gt;
所以，如果要运行ruboto程序，你必须要至少有JRuby来对ruby代码进行转换。&lt;/p&gt;

&lt;h4&gt;解决方案&lt;/h4&gt;

&lt;p&gt;解决方法之一就是上边错误提示所说的：安装另外一个叫做ruboto-core的程序，相当于一个基础类库，之后你所有的基于ruboto的程序就都不需要JRuby依赖了。&lt;br/&gt;
不过我们开发一个app需要用户再去下载另一个就没有多好的用户体验，说不定中途人家就不再安装了呢，&lt;br/&gt;
更何况你在一部手机上安装2个以上的你开发的ruboto程序的几率有多大呢？&lt;/p&gt;

&lt;p&gt;那么还有一种就是将jruby直接打包到当前的工程里边，简单一句命令就OK了：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;ruboto gen jruby
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;这条命令会将jruby放入工程的的libs目录下，再次打包的时候就会将它打进去。这时你的app就是一个可以独立运行的程序。&lt;br/&gt;
更多的信息可以看&lt;a href=&quot;https://github.com/ruboto/ruboto/wiki/Tutorial%3A-Running-Ruboto-without-having-to-install-the-Ruboto-Core&quot;&gt;ruboto的wiki&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;ruboto的特点&lt;/h3&gt;

&lt;p&gt;作为一个rubyist,恨不得世界上所有的项目/平台都用ruby来实现（IronRuby/JRuby 不就是这样吗？），那么ruboto是不是又是一个ruby发烧友在Android上的玩具呢？&lt;/p&gt;

&lt;p&gt;对于这个问题我觉得不是这样理解的，而是：&lt;br/&gt;
1. 我不太了解JAVA，但我想开发Android程序。&lt;br/&gt;
2. 我会Ruby&lt;/p&gt;

&lt;p&gt;不然，直接使用Java来吧。&lt;/p&gt;

&lt;p&gt;如上所述，ruboto就真的像是一个“玩具”而已，但是在实际开发的过程中，我发现ruboto给了我极大的简洁的快感。&lt;/p&gt;

&lt;h4&gt;NO Eclipse&lt;/h4&gt;

&lt;p&gt;每当打开eclipse我都需要停下来喝一杯水，特别是再加上android 那一堆插件后，我在老电脑基本上找不到运指如飞的感觉。&lt;/p&gt;

&lt;p&gt;eclipse在内存占用和资源消耗上的问题或许是它成为优秀开源IDE的原因（这一点和chrome很像），&lt;br/&gt;
但当当初的简洁迅速变得越来越庞大时，你也从工具的使用者变成工具的维护者，我觉得这是在浪费生命。&lt;/p&gt;

&lt;p&gt;而直接使用ant和android tool来，编译起JAVA来又是一件比较“不明觉厉”的事，出问题了也不知道怎么去修改。而ruby就没有这种顾虑，这样又归到rubyist的逻辑上了……&lt;/p&gt;

&lt;h4&gt;NO Compiling&lt;/h4&gt;

&lt;p&gt;关于动态语言和静态语言的对比中，有一个漫画很有意思，在ruboto的github也有：&lt;br/&gt;
&lt;img src=&quot;/images/start_ruboto/compiling.png&quot; alt=&quot;compoling&quot;/&gt;&lt;/p&gt;

&lt;p&gt;ruboto给我最大的感觉就是更新代码后瞬间就可以push到真机上。并且是一个简单的命令：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;$ rake update_scripts:restart
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;使用实例&lt;/h3&gt;

&lt;p&gt;虽然通过上面的创建工程命令可以生成一个简单的例子，但是对于初学者可能还是会无从下手。下面通过一个简单的例子来说明ruboto的使用。&lt;/p&gt;

&lt;p&gt;这个例子只有一个简单的功能：从网络上获取时间并在界面上显示。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;ruboto/widget&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;ruboto/util/toast&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;ruboto/util/stack&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;with_large_stack {require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;net/http&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;}
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;ruboto_import_widgets &lt;span style=&quot;color:#A60&quot;&gt;:Button&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:LinearLayout&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:TextView&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;import &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;android.net.Uri&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span style=&quot;color:#777&quot;&gt;# http://xkcd.com/378/&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Run&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;onCreate&lt;/span&gt;(bundle)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;super&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;    set_title &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Rubotto Demo!&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#069&quot;&gt;self&lt;/span&gt;.content_view =
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;    linear_layout &lt;span style=&quot;color:#A60&quot;&gt;:orientation&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#A60&quot;&gt;:vertical&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;do&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#33B&quot;&gt;@text_view&lt;/span&gt; = text_view &lt;span style=&quot;color:#A60&quot;&gt;:text&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;GeoInker Test&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:id&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#00D&quot;&gt;42&lt;/span&gt;, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;        &lt;span style=&quot;color:#A60&quot;&gt;:layout&lt;/span&gt; =&amp;gt; {&lt;span style=&quot;color:#A60&quot;&gt;:width&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#A60&quot;&gt;:match_parent&lt;/span&gt;},
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#A60&quot;&gt;:gravity&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#A60&quot;&gt;:center&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:text_size&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#60E&quot;&gt;18.0&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;      button &lt;span style=&quot;color:#A60&quot;&gt;:text&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Toast a TOAST&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#A60&quot;&gt;:layout&lt;/span&gt; =&amp;gt; {&lt;span style=&quot;color:#A60&quot;&gt;:width&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#A60&quot;&gt;:match_parent&lt;/span&gt;},
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#A60&quot;&gt;:id&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#00D&quot;&gt;43&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:on_click_listener&lt;/span&gt; =&amp;gt; proc { butterfly }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;      button &lt;span style=&quot;color:#A60&quot;&gt;:text&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Get From URL&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#A60&quot;&gt;:layout&lt;/span&gt; =&amp;gt; {&lt;span style=&quot;color:#A60&quot;&gt;:width&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#A60&quot;&gt;:match_parent&lt;/span&gt;},
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#A60&quot;&gt;:id&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#00D&quot;&gt;44&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:on_click_listener&lt;/span&gt; =&amp;gt; proc { geturl }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#33B&quot;&gt;@data&lt;/span&gt; = text_view &lt;span style=&quot;color:#A60&quot;&gt;:text&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;waiting...&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:id&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#00D&quot;&gt;44&lt;/span&gt;,
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#A60&quot;&gt;:layout&lt;/span&gt; =&amp;gt; {&lt;span style=&quot;color:#A60&quot;&gt;:width&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#A60&quot;&gt;:match_parent&lt;/span&gt;}
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;rescue&lt;/span&gt; &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Exception&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;    puts &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Exception creating activity: &lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;&lt;span style=&quot;font-weight:bold;color:#666&quot;&gt;#{&lt;/span&gt;&lt;span style=&quot;color:#d70&quot;&gt;$!&lt;/span&gt;&lt;span style=&quot;font-weight:bold;color:#666&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n33&quot; name=&quot;n33&quot;&gt;33&lt;/a&gt;&lt;/span&gt;    puts &lt;span style=&quot;color:#d70&quot;&gt;$!&lt;/span&gt;.backtrace.join(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#b0b&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n34&quot; name=&quot;n34&quot;&gt;34&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n35&quot; name=&quot;n35&quot;&gt;35&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n36&quot; name=&quot;n36&quot;&gt;36&lt;/a&gt;&lt;/span&gt;  private
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n37&quot; name=&quot;n37&quot;&gt;37&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n38&quot; name=&quot;n38&quot;&gt;38&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;log_d&lt;/span&gt; str
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n39&quot; name=&quot;n39&quot;&gt;39&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; !(str.is_a? &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;String&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n40&quot; name=&quot;n40&quot;&gt;40&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;      &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Java&lt;/span&gt;::android.util.Log.d &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;AAA&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Not String&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n41&quot; name=&quot;n41&quot;&gt;41&lt;/a&gt;&lt;/span&gt;      log_d str.to_s
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n42&quot; name=&quot;n42&quot;&gt;42&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n43&quot; name=&quot;n43&quot;&gt;43&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n44&quot; name=&quot;n44&quot;&gt;44&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Java&lt;/span&gt;::android.util.Log.d &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;AAA&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;,str
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n45&quot; name=&quot;n45&quot;&gt;45&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n46&quot; name=&quot;n46&quot;&gt;46&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;butterfly&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n47&quot; name=&quot;n47&quot;&gt;47&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#33B&quot;&gt;@num&lt;/span&gt; ||= &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n48&quot; name=&quot;n48&quot;&gt;48&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#33B&quot;&gt;@num&lt;/span&gt; += &lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n49&quot; name=&quot;n49&quot;&gt;49&lt;/a&gt;&lt;/span&gt;    log_d &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;xxxxxx&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n50&quot; name=&quot;n50&quot;&gt;50&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    &lt;span style=&quot;color:#33B&quot;&gt;@text_view&lt;/span&gt;.text = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;GeoInker click &lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;&lt;span style=&quot;font-weight:bold;color:#666&quot;&gt;#{&lt;/span&gt;&lt;span style=&quot;color:#33B&quot;&gt;@num&lt;/span&gt;&lt;span style=&quot;font-weight:bold;color:#666&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt; Time&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n51&quot; name=&quot;n51&quot;&gt;51&lt;/a&gt;&lt;/span&gt;    toast &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Flipped a bit via butterfly&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n52&quot; name=&quot;n52&quot;&gt;52&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n53&quot; name=&quot;n53&quot;&gt;53&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n54&quot; name=&quot;n54&quot;&gt;54&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;get_response&lt;/span&gt; url
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n55&quot; name=&quot;n55&quot;&gt;55&lt;/a&gt;&lt;/span&gt;    log_d url
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n56&quot; name=&quot;n56&quot;&gt;56&lt;/a&gt;&lt;/span&gt;    url_str = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;URI&lt;/span&gt;.parse url
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n57&quot; name=&quot;n57&quot;&gt;57&lt;/a&gt;&lt;/span&gt;    site = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Net&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;HTTP&lt;/span&gt;.new(url_str.host,url_str.port)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n58&quot; name=&quot;n58&quot;&gt;58&lt;/a&gt;&lt;/span&gt;    data = site.get(url_str.request_uri)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n59&quot; name=&quot;n59&quot;&gt;59&lt;/a&gt;&lt;/span&gt;    data.body
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n60&quot; name=&quot;n60&quot;&gt;60&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n61&quot; name=&quot;n61&quot;&gt;61&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;geturl&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n62&quot; name=&quot;n62&quot;&gt;62&lt;/a&gt;&lt;/span&gt;    time_url = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;http://www.clocklink.com/scripts/PSP/ClockLink/TimeGen.dll?ID=&amp;amp;Clock=5012-Pink&amp;amp;TimeZone=GMT0800&amp;amp;Place=&amp;amp;Random=&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;&lt;span style=&quot;font-weight:bold;color:#666&quot;&gt;#{&lt;/span&gt;rand &lt;span style=&quot;color:#00D&quot;&gt;500&lt;/span&gt;&lt;span style=&quot;font-weight:bold;color:#666&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n63&quot; name=&quot;n63&quot;&gt;63&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Thread&lt;/span&gt;.new &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;do&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n64&quot; name=&quot;n64&quot;&gt;64&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;begin&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n65&quot; name=&quot;n65&quot;&gt;65&lt;/a&gt;&lt;/span&gt;        txt = get_response(time_url)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n66&quot; name=&quot;n66&quot;&gt;66&lt;/a&gt;&lt;/span&gt;        log_d txt
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n67&quot; name=&quot;n67&quot;&gt;67&lt;/a&gt;&lt;/span&gt;        log_d &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;after url&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n68&quot; name=&quot;n68&quot;&gt;68&lt;/a&gt;&lt;/span&gt;        txt.gsub! &lt;span style=&quot;background-color:hsla(300,100%,50%,0.06)&quot;&gt;&lt;span style=&quot;color:#404&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color:#808&quot;&gt;[a-z,A-Z]+=&lt;/span&gt;&lt;span style=&quot;color:#404&quot;&gt;/&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n69&quot; name=&quot;n69&quot;&gt;69&lt;/a&gt;&lt;/span&gt;        txt.gsub! &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n70&quot; name=&quot;n70&quot;&gt;70&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;        &lt;span style=&quot;color:#33B&quot;&gt;@data&lt;/span&gt;.postInvalidate
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n71&quot; name=&quot;n71&quot;&gt;71&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#33B&quot;&gt;@data&lt;/span&gt;.text = txt
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n72&quot; name=&quot;n72&quot;&gt;72&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;rescue&lt;/span&gt; &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Exception&lt;/span&gt; =&amp;gt; e
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n73&quot; name=&quot;n73&quot;&gt;73&lt;/a&gt;&lt;/span&gt;        log_d e.class.to_s
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n74&quot; name=&quot;n74&quot;&gt;74&lt;/a&gt;&lt;/span&gt;        log_d e.message
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n75&quot; name=&quot;n75&quot;&gt;75&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n76&quot; name=&quot;n76&quot;&gt;76&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n77&quot; name=&quot;n77&quot;&gt;77&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n78&quot; name=&quot;n78&quot;&gt;78&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n79&quot; name=&quot;n79&quot;&gt;79&lt;/a&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;说明：&lt;/h4&gt;

&lt;h5&gt;1.&lt;code&gt;with_large_stack&lt;/code&gt;的使用&lt;/h5&gt;

&lt;p&gt;如果直接在ruboto上使用诸如&lt;code&gt;open-uri&lt;/code&gt;,&lt;code&gt;net/http&lt;/code&gt;这类ruby的比较“大”的gem时，往往会出现：“stack level to deep”。使用ruboto提供的&lt;code&gt;with_large_stack&lt;/code&gt;方法就可以避免这种错误。&lt;/p&gt;

&lt;h5&gt;2.在ruby中调用原生API&lt;/h5&gt;

&lt;p&gt;这个其实是JRuby的使用，在原Java包的前边加上Java的前缀就可以，比如上述代码中的log_d方法内就使用了android API中的log方法：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Java&lt;/span&gt;::android.util.Log.d &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;AAA&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;,str
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about.html&quot;&gt;Engin&lt;/a&gt; &amp;amp; jekyll&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>fossil的使用</title>
   <link href="http://tom.preston-werner.com/2014/01/26/usage-of-fossil.html"/>
   <updated>2014-01-26T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2014/01/26/usage-of-fossil</id>
   <content type="html">&lt;h3&gt;1.导入导出&lt;/h3&gt;

&lt;p&gt;git ===&amp;gt;  fossil&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;git fast-export --all | fossil import --git newrepo.fossil&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;fossil ===&amp;gt;  git&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;git init newrepo
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;cd newrepo
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;fossil export --git ../repo.fossil | git fast-import&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;!--break--&gt;

&lt;h3&gt;2.功能介绍&lt;/h3&gt;

&lt;h4&gt;2.1迁出最新版本&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil open newrepo.fossil&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;该命令相当于迁出了最新的版本到本地，以下几个命令可以查看迁出版本的状态：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil info
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;fossil status
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;fossil changes
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;fossil diff
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;fossil timeline
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;fossil ls
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;fossil branch&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;你可以将fossil迁出到不同的目录中，不过这样就有些太凌乱了…… &lt;/p&gt;

&lt;h4&gt;2.2改变内容并提交&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;add,rm,addremove&lt;/code&gt;三个命令提供对文件的增加和删除操作；&lt;br/&gt;
&lt;code&gt;commit&lt;/code&gt; 即可将其提交到版本库中（执行commit并不一定会push命令，具体需要设置异步状态。推荐关闭异步直接执行push）&lt;/p&gt;

&lt;h4&gt;2.3同步&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;push和pull来和远程同步；sync命令是将pull和push组合起来的命令：
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;fossil push URL
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;fossil pull URL
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;fossil sync URL&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;需要注意的是，从远程同步过来内容只是在版本库内，如果要迁出到本地的工作目录下，需要执行update命令：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil update [VERSION]&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;2.4合并&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;执行合并之前需要首先将要合并的的分支（目标分支）更新，之后执行merge命令，例如要把dev分支合并到master分支：
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;fossil updata master
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;fossil merge dev
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;fossil commit&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;2.5自建一个github?&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil 一个很吸引人的地方就是它自带的wiki、bug追踪、用户管理等功能。只需要一个简单的命令你就拥有了一个类似github的个人项目主页：
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;fossil ui repo-name
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;fossil server repo-name&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;3.使用实例&lt;/h3&gt;

&lt;h4&gt;3.1新建一个项目：&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil new test.fossil&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;3.2打开版本库&lt;/h4&gt;

&lt;p&gt;fossil是可以将版本库和工作库分开在不同的目录下。此处我们采用在版本库同级目录下新建一个workspace文件夹来存放工作文件：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;mkdir workspace
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;cd workspace
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;workspace&amp;gt;fossil open ../test.fossil
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;执行完open方法后会在目录下多出一个_FOSSIL_(windows)或者.fossil((L)Unix)文件用来记录工作库的状态。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;3.3添加文件&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;随便在目录下增加一个文件，比如version.txt。写入文字信息后将其添加到版本管理中：
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;fossil add .
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;执行：`fossil status` 即可看到当前工作库的相关状态：
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;repository:   D:/soft/fossil/test/workspace/../test.fossil
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;local-root:   D:/soft/fossil/test/workspace/
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;config-db:    C:/Users/Administrator/AppData/Local/_fossil
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;checkout:     95121ec85a5ac89b574778b064c77c9fa34eb122 2014-01-08 02:33:28 UTC
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;tags:         trunk
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;comment:      initial empty check-in (user: Administrator)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;ADDED      version.txt&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;3.4提交&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil commit -m &amp;quot;version 1&amp;quot;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;执行后就将本地更改的内容提交到版本库中。&lt;/p&gt;

&lt;h4&gt;3.5关闭&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil close&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;关闭是和打开对应的。打开是将版本库内的内容迁出到本地库，同时构建一个&lt;em&gt;FOSSIL&lt;/em&gt;文件来维护版本库和工作库直接的关系；&lt;br/&gt;
而关闭则是去除版本库和工作库直接的联系（即删除&lt;em&gt;FOSSIL&lt;/em&gt;文件），但是保留本地工作库中的文件。&lt;br/&gt;
如果再下次再次open版本库内容到当前工作目录时，会提示是否覆盖原内容，就和普通的复制粘贴一样。&lt;/p&gt;

&lt;h4&gt;3.6通过web页面查看&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;fossil ui ../test.fossil&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;执行完命令后会打开你的默认浏览器，并将当前项目的信息显示在浏览器中。&lt;br/&gt;
需要注意的是，我们提交到版本库内的代码、文本的编码最好是UTF-8，否则在web页面中查看时遇到中文等字符时会是乱码。&lt;br/&gt;
不过，如果不更改编码也可以，在版本控制器内的代码可以是任意你迁出到本地支持的编码。&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about.html&quot;&gt;Engin&lt;/a&gt; &amp;amp; jekyll&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>写出快速,节省内存的Javascript代码(二)</title>
   <link href="http://tom.preston-werner.com/2013/04/06/efficientjs2.html"/>
   <updated>2013-04-06T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2013/04/06/efficientjs2</id>
   <content type="html">&lt;h3&gt;写出快速,节省内存的Javascript代码(二)&lt;/h3&gt;

&lt;p&gt;【&lt;a href=&quot;/2013/01/19/efficientjs/&quot;&gt;写出快速,节省内存的Javascript代码(一)&lt;/a&gt;】&lt;/p&gt;

&lt;h4&gt;小心性能陷阱&lt;/h4&gt;

&lt;p&gt;别为优化代码而去优化代码,这点越重视越好.在V8的代码中你很容易看到一些N方法比M方法更高效的地方,但是在某个模块或者整个程序上来看这些优化并不是你所期望的那么有作用.&lt;/p&gt;

&lt;!--break--&gt;

&lt;p&gt;&lt;img src=&quot;/images/fast_javascript/speed-trap.jpg&quot; alt=&quot;过犹不及&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;过犹不及&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;例如我们要创建这样一个模块:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;获取包含数字id值的本地数据&lt;/li&gt;
&lt;li&gt;绘制一个table来存放这些数据&lt;/li&gt;
&lt;li&gt;增加事件监听以便用户点击任意一个单元格都可以触发一个响应.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;尽管这个问题很简单,仍有一些要注意的地方:怎样存储数据?怎样高效地绘制table并加入的DOM中?怎样高效地处理这个table触发的事件.&lt;/p&gt;

&lt;p&gt;对这个问题最直接的方法是把数据放在数组中,然后用jquery遍历这些数据并绘制table再加到DOM中.最后,对单击增加事件绑定处理就可以了.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;注意:以下代码是错误的例子&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;     &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;moduleA&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;         &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;             &lt;span style=&quot;color:#606&quot;&gt;data&lt;/span&gt;: dataArrayObject,
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;             &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;init&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;             &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.addTable();
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;             &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.addEvents();
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;            },
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;             &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;addTable&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                 &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;; i &amp;lt; rows; i++) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;                     &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$tr&lt;/span&gt; = &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;&amp;lt;tr&amp;gt;&amp;lt;/tr&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;                     &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; j = &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;; j &amp;lt; &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.data.length; j++) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;                        &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$tr&lt;/span&gt;.append(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;&amp;lt;td&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt; + &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.data[j][&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;id&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;] + &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;&amp;lt;/td&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;                     }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;                     &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$tr&lt;/span&gt;.appendTo(&lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$tbody&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;                 }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;             },
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;             &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;addEvents&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;                 &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;table td&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;).on(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;click&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                    &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;).toggleClass(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;active&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;                 });
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;             }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;         };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;     }();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#F00;background-color:#FAA&quot;&gt;​&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;就这样就可以完成我们的任务.&lt;br/&gt;
然而在这个例子中,我们使用的数据只有id值,这个数值型的属性放在一个标准的数组中来描述会更简单.有意思的是,直接使用&lt;code&gt;DocumentFragment&lt;/code&gt;和DOM原生的方法会比使用jquery来创建table更高效.并且使用事件委托也会比依次绑定每一个&lt;code&gt;td&lt;/code&gt;要更好.&lt;/p&gt;

&lt;p&gt;注意,在jquery内部并没有使用&lt;code&gt;DocumentFragment&lt;/code&gt;,在我们的例子中,代码在循环中调用&lt;code&gt;append()&lt;/code&gt;方法并且相互之间没有关联,所以并没有优化的空间.这并不是一个棘手的事情,但是确保你的代码能够通过测试.&lt;/p&gt;

&lt;p&gt;这个例子中,修改这些东西可以提高性能.事件委托比简单的事件绑定要高效的多,并且&lt;a href=&quot;http://jsperf.com/first-pass&quot;&gt;使用&lt;code&gt;DocumentFragment&lt;/code&gt;&lt;/a&gt;会有很大的提高.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;moduleD&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;          &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;              &lt;span style=&quot;color:#606&quot;&gt;data&lt;/span&gt;: dataArray,
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;              &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;init&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;                  &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.addTable();
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;                  &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.addEvents();
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;              },
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;              &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;addTable&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;                  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; td, tr;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; frag = document.createDocumentFragment();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;                  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; frag2 = document.createDocumentFragment();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;                  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;; i &amp;lt; rows; i++) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;                      tr = document.createElement(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;tr&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;                      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; j = &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;; j &amp;lt; &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.data.length; j++) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;                          td = document.createElement(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;td&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;                          td.appendChild(document.createTextNode(&lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.data[j]));
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;                          frag2.appendChild(td);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;                      }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;                      tr.appendChild(frag2);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                      frag.appendChild(tr);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;                  }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;                  tbody.appendChild(frag);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;              },
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;              &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;addEvents&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;                  &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;table&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;).on(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;click&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;td&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;                      &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;).toggleClass(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;active&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;                  });
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;              }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;          };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    }();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;我们还可以从其他方面来提升性能.你或许听到过使用原型模式要比模块模式高效,使用javascript的模版框架更加高效.有些时候它们是高效,但是使用它们的原因也是因为它们易读.并且是预编译的!我们来测试下它的实际表现:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;moduleG&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {};
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    moduleG.prototype.data = dataArray;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    moduleG.prototype.&lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;init&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;          &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.addTable();
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;          &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.addEvents();
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    };
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    moduleG.prototype.&lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;addTable&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;          &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; template = _.template(&lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;#template&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;).text());
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;          &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; html = template({&lt;span style=&quot;color:#606&quot;&gt;&lt;span style=&quot;color:#404&quot;&gt;'&lt;/span&gt;&lt;span&gt;data&lt;/span&gt;&lt;span style=&quot;color:#404&quot;&gt;'&lt;/span&gt;&lt;/span&gt; : &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.data});
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;          &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$tbody&lt;/span&gt;.append(html);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;    };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;    moduleG.prototype.&lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;addEvents&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;         &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;table&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;).on(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;click&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;td&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;             &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;$&lt;/span&gt;(&lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;).toggleClass(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;active&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;         });
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;    };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; modG = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; moduleG();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;事实表明,这种方式对效率的提升是微不足道的.[使用模版和原型]并不比我们之前的做法好多少.也就是说,性能并不是优秀的开发者选择他们的原因,选择他们是因为这种继承模型和易维护所带来的易读性.&lt;/p&gt;

&lt;p&gt;其他的问题包括&lt;a href=&quot;http://jsperf.com/canvas-drawimage-vs-webgl-drawarrays/6&quot;&gt;使用canvas高效地绘制图片&lt;/a&gt;和使用&lt;a href=&quot;http://jsperf.com/typed-arrays-for-pixel-manipulation&quot;&gt;类型化数组&lt;/a&gt;&lt;a href=&quot;http://jsperf.com/canvas-pixel-manipulation/30&quot;&gt;操作像素数据&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;在使用一些所谓的标准时最后要先检测一遍再应用的你的程序中.你可以参考&lt;a href=&quot;http://jsperf.com/dom-vs-innerhtml-based-templating/473&quot;&gt;不同JavaScript模版引擎性能预览&lt;/a&gt;和&lt;a href=&quot;http://jsperf.com/javascript-templating-shootoff-extended/26&quot;&gt;对其扩展&lt;/a&gt;.你需要弄清楚测试并没有按照实际部署的应用程序中哪些不常见的规范来压缩,它仅仅是用代码来优化的.&lt;/p&gt;

&lt;h4&gt;V8的优化要点&lt;/h4&gt;

&lt;p&gt;尽管V8的优化要点有很多值得记录下来的,但是一一罗列出来并不是本文的目标.把这些记住就可以帮你减少写出低效率的代码:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;一些模式会让V8陷入无法优化的困境.例如,一个try&lt;em&gt;cach就可以(**译者注:V8的优化器不支持try&lt;/em&gt;cach结构**).关于那些方法结构可以被优化那些不能被优化可以通过V8的一个命令行工具d8执行 &lt;code&gt;--trace-opt 要测试的js文件.js&lt;/code&gt;来获取.&lt;/li&gt;
&lt;li&gt;如果你很关心速度,尽量保持你的函数功能单一.例如,确保变量(包括属性、数组和函数参数)只包含相同的对象隐藏类。例如,不要这样做:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;add&lt;/span&gt;(x, y) { 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; x+y;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        } 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        add(&lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;2&lt;/span&gt;); 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;        add(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;a&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;b&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;); 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        add(my_custom_object, &lt;span style=&quot;color:#069&quot;&gt;undefined&lt;/span&gt;);&lt;span style=&quot;color:#777&quot;&gt;//(*在V8中这两个是不同的hidden class*)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;不要加载没有初始化或者被删除的元素.这在输出上并没有什么问题,但是却会人程序很慢.&lt;/li&gt;
&lt;li&gt;不用写巨大的方法,因为他们优化起来很困难.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;关于更多的要点,参看Daniel Clifford在Google I/O大会上的演讲:&lt;a href=&quot;http://www.youtube.com/watch?v=UJPdhx5zTaw&quot;&gt; Breaking the JavaScript Speed Limit with V8,(youtube)&lt;/a&gt;&lt;a href=&quot;http://v.youku.com/v_show/id_XNDk3NzA2Mjg0.html&quot;&gt;国内优酷地址&lt;/a&gt;.&lt;a href=&quot;http://floitsch.blogspot.co.uk/2012/03/optimizing-for-v8-introduction.html&quot;&gt;V8优化系列&lt;/a&gt;也值得一读.&lt;/p&gt;

&lt;h5&gt;objects vs arrays:我该用那个?&lt;/h5&gt;

&lt;ul&gt;
&lt;li&gt;如果你想存储一串数字,或者一列相同类型的对象(object),使用array.&lt;/li&gt;
&lt;li&gt;如果你在语义上是需要一个包含很多不同类型的属性的对象,就用object并设置属性.这在内存上是很高效的,并且也很快.&lt;/li&gt;
&lt;li&gt;整数索引的元素,不管它是被存在数组array中还是对象object中,&lt;a href=&quot;http://jsperf.com/performance-of-array-vs-object/3&quot;&gt;在迭代是比用对象object属性快&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;object中的属性相当的复杂:它们可以被setters来设置创建,可以有不同的枚举性并且可写.而在数组中的元素就不能被过分的定制了--它们要么存在,要么不存在.object的这种特性在引擎层面就需要在内存组织上对描述这种结构进行更多的优化.包含数值的数组会更好,例如当你需要一系列向量时,别定义一个包含x,y,z属性的类;直接使用array...&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;object和array事实上只有一个最重要的区别:那就是array的魔法属性&lt;code&gt;length&lt;/code&gt;.如果你自己在object中记录这个属性,那么在V8中object和array是一样快的.&lt;/p&gt;

&lt;h5&gt;使用对象（object）的注意点：&lt;/h5&gt;

&lt;ul&gt;
&lt;li&gt;使用构造方法来创建对象：这样可以确保所有通过它创建出来的对象具有相同的hidden class，并且避免改变这些隐藏类。并且这样做也&lt;a href=&quot;http://jsperf.com/object-create-vs-constructor-vs-object-literal/7&quot;&gt;比直接使用&lt;code&gt;Object.create()&lt;/code&gt;快&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;尽管在程序中使用多少个对象类型并没有限制，但是太长的属性链还是会影响性能。并且具有少量属性的对象比大的对象要高效的多。对与一些频繁使用的对象，应该尽量让它的属性链和属性个数少。&lt;/li&gt;
&lt;/ul&gt;

&lt;h6&gt;对象拷贝&lt;/h6&gt;

&lt;p&gt;对象拷贝是每个开发者都会遇到的问题。尽管可以一一罗列出V8在处理这个问题上的很多优秀的处理方法，但是还是要做谨慎地拷贝。拷贝大的对象时特别的慢，所有尽量别这样做。在JavaScript中&lt;code&gt;for..in&lt;/code&gt;的循环不管任何引擎去实现都很慢，因为它的技术规范很糟糕……&lt;br/&gt;
如果你必须要拷贝一个对象，用一个数组或者定制的“拷贝构造”方法来拷贝每一个属性。这应该是最快的方式了。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;clone&lt;/span&gt;(original) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.foo = original.foo;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;.bar = original.bar;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; copy = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; clone(original);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h6&gt;在模块中使用缓存方法&lt;/h6&gt;

&lt;p&gt;在模块中使用缓存方法可以提供效率。下边的例子能说明我们平常使用变量的方法是很慢的，因为它总是拷贝成员方法。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/fast_javascript/module_pattern.png&quot; alt=&quot;module_pattern&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#777&quot;&gt;// Prototypal pattern&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;Klass1&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {}
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        Klass1.prototype.&lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;foo&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;            log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;foo&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        Klass1.prototype.&lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;bar&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;            log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;bar&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#777&quot;&gt;// Module pattern&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;Klass2&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;foo&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;                log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;foo&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;            },
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;bar&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;                log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;bar&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;            };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#606&quot;&gt;foo&lt;/span&gt;: foo,
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#606&quot;&gt;bar&lt;/span&gt;: bar
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;            }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#777&quot;&gt;// Module pattern with cached functions&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;FooFunction&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;            log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;foo&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;        };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;BarFunction&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;            log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;bar&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n33&quot; name=&quot;n33&quot;&gt;33&lt;/a&gt;&lt;/span&gt;        };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n34&quot; name=&quot;n34&quot;&gt;34&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n35&quot; name=&quot;n35&quot;&gt;35&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;Klass3&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n36&quot; name=&quot;n36&quot;&gt;36&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n37&quot; name=&quot;n37&quot;&gt;37&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#606&quot;&gt;foo&lt;/span&gt;: FooFunction,
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n38&quot; name=&quot;n38&quot;&gt;38&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#606&quot;&gt;bar&lt;/span&gt;: BarFunction
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n39&quot; name=&quot;n39&quot;&gt;39&lt;/a&gt;&lt;/span&gt;            }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n40&quot; name=&quot;n40&quot;&gt;40&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n41&quot; name=&quot;n41&quot;&gt;41&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n42&quot; name=&quot;n42&quot;&gt;42&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n43&quot; name=&quot;n43&quot;&gt;43&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#777&quot;&gt;// Iteration tests&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n44&quot; name=&quot;n44&quot;&gt;44&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n45&quot; name=&quot;n45&quot;&gt;45&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#777&quot;&gt;// Prototypal&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n46&quot; name=&quot;n46&quot;&gt;46&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;1000&lt;/span&gt;,
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n47&quot; name=&quot;n47&quot;&gt;47&lt;/a&gt;&lt;/span&gt;            objs = [];
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n48&quot; name=&quot;n48&quot;&gt;48&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;while&lt;/span&gt; (i--) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n49&quot; name=&quot;n49&quot;&gt;49&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; o = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; Klass1()
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n50&quot; name=&quot;n50&quot;&gt;50&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            objs.push(&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; Klass1());
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n51&quot; name=&quot;n51&quot;&gt;51&lt;/a&gt;&lt;/span&gt;            o.bar;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n52&quot; name=&quot;n52&quot;&gt;52&lt;/a&gt;&lt;/span&gt;            o.foo;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n53&quot; name=&quot;n53&quot;&gt;53&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n54&quot; name=&quot;n54&quot;&gt;54&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n55&quot; name=&quot;n55&quot;&gt;55&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#777&quot;&gt;// Module pattern&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n56&quot; name=&quot;n56&quot;&gt;56&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;1000&lt;/span&gt;,
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n57&quot; name=&quot;n57&quot;&gt;57&lt;/a&gt;&lt;/span&gt;            objs = [];
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n58&quot; name=&quot;n58&quot;&gt;58&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;while&lt;/span&gt; (i--) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n59&quot; name=&quot;n59&quot;&gt;59&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; o = Klass2()
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n60&quot; name=&quot;n60&quot;&gt;60&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            objs.push(Klass2());
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n61&quot; name=&quot;n61&quot;&gt;61&lt;/a&gt;&lt;/span&gt;            o.bar;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n62&quot; name=&quot;n62&quot;&gt;62&lt;/a&gt;&lt;/span&gt;            o.foo;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n63&quot; name=&quot;n63&quot;&gt;63&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n64&quot; name=&quot;n64&quot;&gt;64&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n65&quot; name=&quot;n65&quot;&gt;65&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#777&quot;&gt;// Module pattern with cached functions&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n66&quot; name=&quot;n66&quot;&gt;66&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;1000&lt;/span&gt;,
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n67&quot; name=&quot;n67&quot;&gt;67&lt;/a&gt;&lt;/span&gt;            objs = [];
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n68&quot; name=&quot;n68&quot;&gt;68&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;while&lt;/span&gt; (i--) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n69&quot; name=&quot;n69&quot;&gt;69&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; o = Klass3()
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n70&quot; name=&quot;n70&quot;&gt;70&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            objs.push(Klass3());
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n71&quot; name=&quot;n71&quot;&gt;71&lt;/a&gt;&lt;/span&gt;            o.bar;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n72&quot; name=&quot;n72&quot;&gt;72&lt;/a&gt;&lt;/span&gt;            o.foo;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n73&quot; name=&quot;n73&quot;&gt;73&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n74&quot; name=&quot;n74&quot;&gt;74&lt;/a&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;：当你并不需要一个类时就别用。你可以通过这个链接来了解怎样通过去除类来提高性能的&lt;a href=&quot;http://jsperf.com/prototypal-performance/54&quot;&gt;http://jsperf.com/prototypal-performance/54&lt;/a&gt;&lt;/p&gt;

&lt;h5&gt;使用数组的注意点：&lt;/h5&gt;

&lt;p&gt;接下来我们看看使用数组的注意点。一般来说，&lt;strong&gt;不用删除数组的元素&lt;/strong&gt;。这会让数组内部响应越来越慢。当设置的关键字变得”疏松“，V8会把它转向比较慢的字典模式。&lt;/p&gt;

&lt;h6&gt;数组字面量（Array Literals）&lt;/h6&gt;

&lt;p&gt;Array Literals 很有用，因为它告诉解释器数组的类型和大小，这对中小型数组很有用。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;// Here V8 can see that you want a 4-element array containing numbers:&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; a = [&lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;2&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;3&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;4&lt;/span&gt;];
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;// Don't do this:&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    a = []; &lt;span style=&quot;color:#777&quot;&gt;// Here V8 knows nothing about the array&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt;(&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt;; i &amp;lt;= &lt;span style=&quot;color:#00D&quot;&gt;4&lt;/span&gt;; i++) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;           a.push(i);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    }
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h6&gt;单类型存储还是混合存储？&lt;/h6&gt;

&lt;p&gt;最后不要把不同类型（如数值，字符串，undefined或者布尔）的元素放在同一个数组中（例如：&lt;code&gt;var arr = [1, “1”, undefined, true, “true”]&lt;/code&gt;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jsperf.com/type-inference-performance/2&quot;&gt;类型影响测试&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从结果中我们可以看到，使用纯int的数组要快些。&lt;/p&gt;

&lt;h6&gt;稀疏的数组与完整的数组&lt;/h6&gt;

&lt;p&gt;当你使用稀疏数组时要注意，获取它的要素的速度要不一个完整的数组要慢。这是因为V8并不会因为仅仅少数几个元素在使用而压缩存储。V8用字典的方式来节省空间，但这样在获取上要稍微费时点。&lt;br/&gt;
&lt;a href=&quot;http://jsperf.com/sparse-arrays-vs-full-arrays&quot;&gt;稀疏数组和完整数组的测试&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;【&lt;strong&gt;译者注：所谓的稀疏数组简单地说就是定义了&lt;code&gt;var arr=[]&lt;/code&gt;之后，通过&lt;code&gt;arr[0]=100;arr[100]=1000&lt;/code&gt;这种间断地赋值造成数组中有未真正赋值的元素&lt;/strong&gt;】&lt;/p&gt;

&lt;p&gt;在完整数组的求和运算中，不管是否包含0其计算速度大概是相同的。&lt;/p&gt;

&lt;h6&gt;打包的数组和带”洞“的数组&lt;/h6&gt;

&lt;p&gt;避免使用带”洞“的数组（删除了数组的元素或者通过下标大于长度的方式赋值）。即使只有一个元素被删除了，整个数组都会变慢。&lt;br/&gt;
&lt;a href=&quot;http://jsperf.com/packed-vs-holey-arrays&quot;&gt;打包的数组和带”洞“的数组的测试&lt;/a&gt;&lt;/p&gt;

&lt;h6&gt;预先分配数组空间还是逐渐增加&lt;/h6&gt;

&lt;p&gt;不用一下就预先分配大的数组（比如元素超过64k），而要让其自增。在测试之前请注意：这一点只适用于部分javascript引擎。&lt;br/&gt;
&lt;img src=&quot;/images/fast_javascript/graph2.jpg&quot; alt=&quot;graph2&quot;/&gt;&lt;br/&gt;
&lt;em&gt;Test of empty literal versus pre-allocated array in various browsers.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Nitro(Safari)对预先分配数组容量提供了很好的支持，而其他的引擎（V8，SpiderMonkey）不预先分配会更好。&lt;br/&gt;
&lt;a href=&quot;&quot;&gt;预先分配的测试&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;// Empty array&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; arr = [];
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&quot;color:#00D&quot;&gt;1000000&lt;/span&gt;; i++) {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;          arr[i] = i;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    }
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;// Pre-allocated array&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; arr = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; Array(&lt;span style=&quot;color:#00D&quot;&gt;1000000&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i = &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&quot;color:#00D&quot;&gt;1000000&lt;/span&gt;; i++) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;          arr[i] = i;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    }
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>写出快速,节省内存的Javascript代码(一)</title>
   <link href="http://tom.preston-werner.com/2013/01/19/efficientjs.html"/>
   <updated>2013-01-19T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2013/01/19/efficientjs</id>
   <content type="html">&lt;h3&gt;写出快速,节省内存的Javascript代码(一)&lt;/h3&gt;

&lt;p&gt;这是一篇翻译文章,原文为:&lt;a href=&quot;http://coding.smashingmagazine.com/2012/11/05/writing-fast-memory-efficient-javascript/&quot;&gt;Writing Fast, Memory-Efficient JavaScript&lt;/a&gt;&lt;br/&gt;
​&lt;/p&gt;

&lt;!--break--&gt;

&lt;p&gt;像google V8(Chrome和Node.js)这样的JavaScript解析引擎是为大型JavaScript应用能够快速执行而设计的.在你开发的过程中,如果你关心内存使用和性能,你就应该了解用户浏览器下的JavaScript解析引擎的原理.&lt;/p&gt;

&lt;p&gt;不管是V8还是 SpiderMonkey (Firefox), Carakan(Opera), Chakra (IE)或者其他的解析引擎, 知道他们的原理可以更好地优化你的程序.&lt;/p&gt;

&lt;p&gt;但是这并不是说你就要针对一个浏览器或者一个解析引擎来优化,别做傻事了...&lt;/p&gt;

&lt;p&gt;你应该这样思考:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt; 我的代码里是否有更高效的方法?&lt;/li&gt;
&lt;li&gt; 那些流行的JavaScript引擎都采用怎样的优化方法?&lt;/li&gt;
&lt;li&gt; 哪些是引擎无法优化的?哪些内容是垃圾回收机制可以帮我释放的?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/fast_javascript/car_engine.jpg&quot; alt=&quot;car_engine&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;能够快速加载的网站和能够高速行驶的跑车一样,需要使用专业的工具.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;有很多的陷阱使你无法写出高效节省内存的Javascript代码,本文我们将要去探索那些已经被测试为能够提升代码效率的方法.&lt;/p&gt;

&lt;h4&gt;V8引擎是怎样解析JavaScript的?&lt;/h4&gt;

&lt;p&gt;尽管你不需要了解JavaScript解析引擎的详细内容就可以构建一个大型的JavaScript应用程序,但是作为一个好司机差不多都会对他爱车的发动机看上一眼吧.由于Chrome是我的使用的浏览器,我准备说一点它的JavaScript解析引擎.V8由几个核心部件构成:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;一个基础的&lt;strong&gt;编译器&lt;/strong&gt;:和其他的编译器不同的是它并不是执行字节码或者简化解释器,而是在执行前将JavaScript代码解析后直接转换为机器码.不过这段代码这个时候并不是被高度优化的.&lt;/li&gt;
&lt;li&gt;V8使用对象模型来描述你的对象.在JavaScript中对象被描述为相关联的数组,而在V8中它们被描述为&lt;a href=&quot;https://developers.google.com/v8/design&quot;&gt;hidden classes&lt;/a&gt;.hidden classes是高效查找的内部类型系统.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;运行时分析器&lt;/strong&gt;检测运行的系统并标记出&amp;quot;热&amp;quot;方法(例如一段运行了很长时间的代码)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;一个优化编译器&lt;/strong&gt;重新编译并优化被运行时分析器标记为&amp;quot;热&amp;quot;方法的代码,执行诸如代码嵌入的优化(例如将函数调用替换为回调函数)&lt;/li&gt;
&lt;li&gt;V8支持&lt;strong&gt;逆向优化&lt;/strong&gt;,即当优化编译器发现它之前优化的代码是被过度优化,它会释放之前产生的代码.&lt;/li&gt;
&lt;li&gt;它有一个&lt;strong&gt;垃圾回收器&lt;/strong&gt;.理解它是如何工作的能有助于优化JavaScript代码.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;垃圾回收器&lt;/h4&gt;

&lt;p&gt;垃圾回收机制是内存管理的一个方式.它被用在当一个对象不再被使用时来回收这个对象占用的内存.在像JavaScript这样的具有垃圾回收机制的语言中,当对象还在被引用着是不会被释放的.&lt;/p&gt;

&lt;p&gt;在大部分常见下并不需要手动取消引用.仅仅通过注意变量的位置(作用域越小越好,例如在方法需要的变量在内部定义而不是外部)就可以了.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/fast_javascript/robot-cleaner.jpg&quot; alt=&quot;garbage_collection&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;垃圾回收器尝试回收内存&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;在JavaScript中是无法强制垃圾回收.你不能这样做是因为:垃圾回收进程是被运行时控制,它知道什么时间来清理垃圾.&lt;/p&gt;

&lt;h5&gt;清除错误的引用&lt;/h5&gt;

&lt;p&gt;在网上相当多的关于JavaScript的回收内存的讨论中很多是关于&lt;code&gt;delete&lt;/code&gt;关键字.尽管它只是被用来从map中移除keys,一些开发者却认为它可以强制取消引用.尽量避免使用&lt;code&gt;delete&lt;/code&gt;关键字.在下边的例子中,&lt;code&gt;delete o.x&lt;/code&gt;这段代码有很多害处,因为它改变了对象o的hidden class,让它变成一个相对慢的对象.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; o = { &lt;span style=&quot;color:#606&quot;&gt;x&lt;/span&gt;: &lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt; }; 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;delete&lt;/span&gt; o.x; &lt;span style=&quot;color:#777&quot;&gt;// true &lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    o.x; &lt;span style=&quot;color:#777&quot;&gt;// undefined&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;不过,你肯定可以在许多流行的JavaScript库中看的&lt;code&gt;delete&lt;/code&gt;--它确实有它的用途.这里不使用的原因是为了避免修改运行时中的&amp;quot;热&amp;quot;对象的数据结构.JavaScript引擎可以侦测到这种&amp;quot;热&amp;quot;对象并且尝试去优化它们.如果这个对象的结构在它的生命周期内没有太大的改变这种侦测就很简单,但是&lt;code&gt;delete&lt;/code&gt;可以却这种改变让侦测变得复杂.&lt;/p&gt;

&lt;p&gt;关于&lt;code&gt;null&lt;/code&gt;的使用也有误区.把一个对象设为&lt;code&gt;null&lt;/code&gt;,并没有把对象清空,而是把对象的引用设为空.使用&lt;code&gt;o.x = null&lt;/code&gt;比使用&lt;code&gt;delete&lt;/code&gt;好,但是这可能并不必要.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; o = { &lt;span style=&quot;color:#606&quot;&gt;x&lt;/span&gt;: &lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt; }; 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    o = &lt;span style=&quot;color:#069&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    o; &lt;span style=&quot;color:#777&quot;&gt;// null&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    o.x &lt;span style=&quot;color:#777&quot;&gt;// TypeError&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;如果这个引用是这个对象的最后一次引用,那么这个对象会被回收,如果这次引用不是最后一个引用,这个对象仍然可以获取而不会被释放.&lt;/p&gt;

&lt;p&gt;另外一个要注意的是全局变量并不会在你页面的生命周期内被释放.不过这个页面被打开多久,全局对象的作用域在JavaScript运行时中始终留存.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; myGlobalNamespace = {};
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;全局变量只有在你刷新页面、跳转到另一个页面、关闭标签或者退出你的浏览器时才会被清除.函数作用域中的变量会在函数结束时释放.当函数已经退出并且它们不再被引用时变量才会被释放.&lt;/p&gt;

&lt;h5&gt;经验法则&lt;/h5&gt;

&lt;p&gt;为了让垃圾回收器能够尽早回收更多的对象,&lt;strong&gt;别保留你不在需要的对象&lt;/strong&gt;.这经常在无意中发生;记住下边的要点:&lt;br/&gt;
* 像前边说的,最好在最近位置使用变量.例如,当一个全局变量在外部为空时用函数级的变量这样就会在不使用时释放.&lt;br/&gt;
* 确保在事件响应listeners不在需要时移除它们,特别是当这些listeners绑定的DOM对象将要被移除的时候.&lt;br/&gt;
* 如果你使用了局部的数据缓存,确保删除它们或者通过一定的塌陷机制来避免大量的不被重用的数据被存储.&lt;/p&gt;

&lt;h5&gt;函数&lt;/h5&gt;

&lt;p&gt;接下来我们看看函数.我们前边说过,垃圾回收机制作用在那些不再能够获取到的内存(对象)中.为了更好的举例,这儿有一个例子:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;foo&lt;/span&gt;() {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; bar = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; LargeObject();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;      bar.someCall();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    }
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;当&lt;code&gt;foo&lt;/code&gt;函数返回后,&lt;code&gt;bar&lt;/code&gt;所指向的对象会被垃圾回收器释放,因为没有任何对象再引用它了.&lt;/p&gt;

&lt;p&gt;对比下边的代码:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;foo&lt;/span&gt;() {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; bar = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; LargeObject();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;      bar.someCall();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; bar;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;// somewhere else&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; b = foo();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;现在我们有了一个对该对象的引用,并且这个引用会一直保持到&lt;code&gt;b&lt;/code&gt;被赋值为其他对象(或者&lt;code&gt;b&lt;/code&gt;超出作用域)&lt;/p&gt;

&lt;h5&gt;闭包&lt;/h5&gt;

&lt;p&gt;当你看到一个方法返回一个内部方法,这个内部方法就能够被外部作用域内的变量引用,即便它已经超出了被调用方法的作用域.&lt;br/&gt;
这就是闭包:能够将变量设置到特殊的上下文环境中.例如:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;sum&lt;/span&gt; (x) {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;sumIt&lt;/span&gt;(y) {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; x + y;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;      };
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; sumIt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    }
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;// Usage&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; sumA = sum(&lt;span style=&quot;color:#00D&quot;&gt;4&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; sumB = sumA(&lt;span style=&quot;color:#00D&quot;&gt;3&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    console.log(sumB); &lt;span style=&quot;color:#777&quot;&gt;// Returns 7&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;在调用&lt;code&gt;sum&lt;/code&gt;函数的上下文环境中创建的函数对象不会被回收,因为它被一个全局变量引用仍然可以使用.它仍然可以通过&lt;code&gt;sumA&lt;/code&gt;来执行.&lt;/p&gt;

&lt;p&gt;我们看看另一个例子,在这个例子中我们可以使用&lt;code&gt;largeStr&lt;/code&gt;吗?&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;a&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; largeStr = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; Array(&lt;span style=&quot;color:#00D&quot;&gt;1000000&lt;/span&gt;).join(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;x&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; largeStr;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;      };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    }();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;是的,我们仍然可以通过&lt;code&gt;a()&lt;/code&gt;获取到&lt;code&gt;largeStr&lt;/code&gt;,但是如果这样呢:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;a&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; smallStr = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;x&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; largeStr = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; Array(&lt;span style=&quot;color:#00D&quot;&gt;1000000&lt;/span&gt;).join(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;x&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; (n) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; smallStr;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    };
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    }();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;这样就无法获取&lt;code&gt;largeStr&lt;/code&gt;,它就会被当做垃圾来回收.&lt;/p&gt;

&lt;h5&gt;计时器&lt;/h5&gt;

&lt;p&gt;内存泄露最厉害的地方是在循环上,或者在&lt;code&gt;setTimeout()/setInterval()&lt;/code&gt;方法上.但这很常见.&lt;/p&gt;

&lt;p&gt;看一下下边的例子:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; myObj = {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;callMeMaybe&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; myRef = &lt;span style=&quot;color:#963&quot;&gt;this&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; val = setTimeout(&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; () { 
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;        console.log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Time is running out!&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;); 
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;          myRef.callMeMaybe();
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        }, &lt;span style=&quot;color:#00D&quot;&gt;1000&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;      }
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;    };
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;如果我们执行:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    myObj.callMeMaybe();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;来开始计时,我们每秒钟都会看的打印出来的&amp;#39;Time is running out!&amp;#39;.即便是我们执行:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    myObj=&lt;span style=&quot;color:#069&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;计时器仍然在运行.&lt;code&gt;myObj&lt;/code&gt;不会被回收是因为传入到&lt;code&gt;setTimeout&lt;/code&gt;方法中的闭包一直在保持着.也就是说,它因为使用了&lt;code&gt;myRef&lt;/code&gt;而一直保持着对&lt;code&gt;myObj&lt;/code&gt;的引用.如果我们把一个闭包传给任何一个别的函数,这个函数就会保持着对这个闭包的引用.&lt;br/&gt;
还有一点需要注意的是在&lt;code&gt;setTimeout/setInterval&lt;/code&gt;方法内部所引用的函数等需要执行完毕后才会被释放.&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>七个富应用JavaScript框架</title>
   <link href="http://tom.preston-werner.com/2012/12/29/seven-javascript.html"/>
   <updated>2012-12-29T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/12/29/seven-javascript</id>
   <content type="html">&lt;p&gt;七个富应用JavaScript框架&lt;br/&gt;
这是一篇翻译文章，原文在&lt;a href=&quot;http://blog.stevensanderson.com/2012/08/01/rich-javascript-applications-the-seven-frameworks-throne-of-js-2012/&quot;&gt;Rich JavaScript Applications – the Seven Frameworks (Throne of JS, 2012)&lt;/a&gt;&lt;/p&gt;

&lt;!--break--&gt;

&lt;h3&gt;正文&lt;/h3&gt;

&lt;p&gt;一周之前(原文是2012年8月1日发表)在多伦多举行的Throne of JS大会是我最近参加的一个最有意思的会议.它的网站上这样说:&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;先前的将网页完全加载进来再&amp;quot;慢慢地处理&amp;quot;以使页面能动态地表现出来的方法已经不是最优的方案.构建流畅,快速响应和现代的应用要求你重新构思你的实现方法.&lt;br/&gt;
这个引言是引出七个顶级的为单个页面或者富JS应用设计的JavaScript库和框架:AngularJS, Backbone, Batman, CanJS, Ember, Meteor, Knockout, Spine.把他们的创建者召集在一起,当面来比较各自的实现技术.&lt;br/&gt;
免责声明:我参加这场大会是去展示Knockout(&lt;em&gt;译者注:作者Steven是Knockout.js的作者&lt;/em&gt;),所以很明显我并不是中立的.在这篇文章中我着重于他们的创建者对他们使用的技术的领域和理念的陈述,并不代表我赞同或者不赞同.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;

&lt;p&gt;上边列出的是8个而不是7个,这个问题还没有人解释(&lt;strong&gt;译者注:Trone of JS官网上的标题是7个框架,可能是泛指&lt;/strong&gt;);&lt;/p&gt;

&lt;h3&gt;概要:&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;对大部分开发者来说,使用客户端框架来构建富网络应用已经是理所当然的.如果你没有使用,那么你要么是不开发程序要么是已经out了.&lt;/li&gt;
&lt;li&gt;主要的框架对构建网络应用都有许多一致的地方(Model-View-*架构,声明式绑定等).所以无论你选择哪种框架,你都能获取相似的功能.&lt;/li&gt;
&lt;li&gt;一些主要的理念仍然有不同,特别是框架和类库之间的差别.你的选择可能会影响你的架构.&lt;/li&gt;
&lt;li&gt;这次大会很时髦很热闹,我们和不同的技术团体之间有很多社交活动和会谈.我喜欢这种方式.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;技术上的争论:赞同与反对&lt;/h3&gt;

&lt;p&gt;就像以往的SPA(&lt;strong&gt;译者注:single-page application,指在一个页面中通过ajax等技术来让用户体验一个连续流程的应用&lt;/strong&gt;)技术会议一样,一些相对清晰模式的相同和不同观点的争论也出现了.&lt;/p&gt;

&lt;h4&gt;赞同点:渐进增强并不适用构建真正的应用.(&lt;strong&gt;译者注:渐进增强关注于内容,针对不同的浏览器做优化&lt;/strong&gt;)&lt;/h4&gt;

&lt;p&gt;所有的技术都应该遵循这一的准则:严肃的JS应用程序需要合适的数据模型以及渲染客户端的能力,而不仅仅是处理ajax请求和调用jQuery的简单代码.&lt;br/&gt;
引用Backbone作者Jeremy Ashkenas的话：＂就这点而言，说起单页面应用程序(SPA)就好像在说没有马的马车＂(这种观点已经不新鲜了...)&lt;/p&gt;

&lt;h4&gt;赞同点:Model-View-Whatever模型&lt;/h4&gt;

&lt;p&gt;所有的技术都使用了模型\视图分离的模式.有的人专门讨论MVC,有的人讨论MVVM,甚至有的压根不去定义模型\视图之外的其他内容(只是说有模型,视图,以及让他们在运行起来的其他东西).这就使得基本上每个框架都很相似.&lt;/p&gt;

&lt;h4&gt;赞同点:数据绑定&lt;/h4&gt;

&lt;p&gt;除了Backbone和spine之外,其他的都在视图中有内建的声明式数据绑定(backbone有&amp;quot;bring your own view technology&amp;quot;的设计).&lt;/p&gt;

&lt;h4&gt;赞同点:IE6已死&lt;/h4&gt;

&lt;p&gt;在一个小组的讨论中,大部分框架的作者说他们对IE的支持是在IE7以上(事实上,Ember和AngularJS只支持IE8以上,Batman在IE9以下的IE浏览器上需要ES5 shim才能运行).这就是将要发生的:连jQuery的2.版本也将放弃对IE9以下的支持.&lt;br/&gt;
只有Backbone和Knockout仍然支持IE6以上(我不知道Backbone的内部构件,但是对Knockout而言这意味着要面对处理大量令人发疯的IE6/IE7边缘的渲染和事件机制的命运.&lt;/p&gt;

&lt;h4&gt;赞同点:授权协议和源代码控制&lt;/h4&gt;

&lt;p&gt;都是采用MIT授权协议,并且源代码托管在github上.&lt;/p&gt;

&lt;h4&gt;争论点:类库VS框架&lt;/h4&gt;

&lt;p&gt;这是目前最大的分歧地方,我们可以按照以下方式分组:&lt;/p&gt;

&lt;table border=2&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;strong&gt;类库&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;框架&lt;/strong&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;p&gt;Backbone (9552)&lt;/p&gt;&lt;p&gt;Knockout (2357)&lt;/p&gt;&lt;p&gt;Spine (2017)&lt;/p&gt;&lt;p&gt;CanJS (321)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;Ember (3993)&lt;/p&gt;&lt;p&gt;AngularJS (2925)&lt;/p&gt;&lt;p&gt;Batman (958)&lt;/p&gt;&lt;p&gt;Meteor (4172) — unusual, see later&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table &gt;

小括号内的数字是某一时刻各个项目在GitHub上关注者数量的快照,作为一个相对影响力的指标.

这意味着什么呢?

*  **类库**可以集成到你的已存在的架构总并且增加特定的功能.
*  **框架**为你提供了一个架构(文件结构等),你可以使用它来处理常见的需求.
到目前为止,最受追捧的框架模型时Ember,它的作者Yehuda Katz是以前Rails和SproutCore 项目的开发者之一.
他的观点是任何功能简单的东西都不够强大并且并没有对这种状态有实质性的提高.
相反的观点认为类库更加专注于解决问题,因此可以被简单地学习,接收和定制,并且能够减小项目因过分依赖一个第三方项目所带来的风险.
根据我参与的谈论,我觉得观众被分为两派,各自支持自己的观点.

需要指出一点:AngularJS 在某种程度上既是类库又是框架:他在开发阶段并没有要求一个特定的文件结构(像类库的部分),
但是在运行时它提供了一个&quot;应用生命周期&quot;来加入你的代码(像框架的部分).
我把它列在框架中是因为这是AngularJS团队选择的技术.

#### 争论点:什么是灵活?什么是集成? 
每个技术都有不同层次的约定:
&lt;table border=2&gt;&lt;tbody&gt;&lt;tr&gt;


&lt;td valign=&quot;top&quot;&gt;&lt;/td&gt;&lt;td valign=&quot;top&quot;&gt;&lt;p&gt;&lt;strong&gt;视图&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td valign=&quot;top&quot;&gt;&lt;p&gt;&lt;strong&gt;URL 路由&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;&lt;strong&gt;数据存储&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;AngularJS&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置基于DOM的模版(必须使用)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置(可选)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置系统(可选)&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;Backbone&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;自己选择 (必须使用一个字符串模版handlebars.js)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置(可选)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置(可重写)&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;Batman&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置基于DOM的模版(必须使用) &lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置(必须使用) &lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置系统(必须使用) &lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;CanJS&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置基于字符串的模版(必须使用)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置(可选) &lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置(可选) &lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;Ember&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置基于字符串的模版(必须使用) &lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置(必须使用) &lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置(可重写) &lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;Knockout&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;  内置基于DOM的模版(可选,也可以做基于字符串的)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;自己选择(大多选择sammy.js或者history.js)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;自己选择(例如: knockout.mapping 或者 $.ajax)&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;Meteor&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置基于字符串的模版(必须使用) &lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置(必须使用?)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置 (Mongo, mandatory)&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;

&lt;tr&gt;&lt;td&gt;&lt;p&gt;&lt;strong&gt;Spine&lt;/strong&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;自己选择基于字符串的模版&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt;内置(可选)&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p&gt; 内置(可选?)&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;正如所预料的一样,当一个类库觉得要做得开放一些,他的作者们就认为确保能够和其他第三方库组合是很重要的.而相反的观点是如果能够通过内建的方法集成可以让框架的各个部分无缝结合.这次观众又再次被分为不同的阵营.&lt;br/&gt;
引用Tom Dale的一句话:&amp;quot;我们做了很多美妙的东西,并且真正不可思议的是它可以分成功一个个功能齐全的单元.&amp;quot;&lt;/p&gt;

&lt;h4&gt;争论点: 基于字符的还是基于DOM的模版&lt;/h4&gt;

&lt;p&gt;(正如前表所述)对与基于字符串的模版大都选择Handlebars.js作为模版引擎.关于字符串模板的争论主要包括&amp;quot;它很快&amp;quot;(并未通过表决)并且&amp;quot;理论上服务器也可以渲染他们&amp;quot;(这一点也在争论中,因为只有你吧所有的模型代码都搬到服务器上才能实现,而实际上没有人这么做).&lt;br/&gt;
基于DOM的模板一般都是纯粹地通过绑定到你的标签来做控制的(通过each,if等语句),这就对其他扩展的模版没有依赖.关于DOM模版的争论点主要包括&amp;quot;它很快&amp;quot;(并未通过表决),&amp;quot;代码可以易读易写,因为没有模版和标签之间的不协调,并且可以通过CSS来和它交互&amp;quot;.&lt;br/&gt;
以我看,最有力的论点是AngularJS的成员所指出的:在不久的将来,他们期望基于DOM的模版成为浏览器的原生支持,所以我们应该从现在就为将来的适应做准备.AngularJS来自Google,他们已经在Chromium和标准机构上实现.&lt;/p&gt;

&lt;h4&gt;争论点:服务端的依赖层次.(Levels of server-agnosticism)&lt;/h4&gt;

&lt;p&gt;Batman 和Meteor对服务端有明显的依赖:Batman是为Rails而设计的,而Meteor使用的是自己的服务端程序.其他的大部分都以适应任何服务端为目标,但是对Ember来说实际上不管是架构、约定还是其他的工具都倾向于rails开发者。Ember绝对是可以应用于其他的服务端技术的，只不过其设置稍微麻烦点。&lt;/p&gt;

&lt;h3&gt;各个框架的技术速览&lt;/h3&gt;

&lt;h4&gt;Backbone&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者：Jeremy Ashkenas and DocumentCloud&lt;/li&gt;
&lt;li&gt;内容：

&lt;ul&gt;
&lt;li&gt;Model-View模式，MIT 许可&lt;/li&gt;
&lt;li&gt;最小的类库——仅仅一个文件，800行代码！&lt;/li&gt;
&lt;li&gt;很专一的功能——仅仅提供REST持久化模型以及简单的路由和回调，这样就可以让你知道什么时候去渲染实体（需要自己设置渲染机制）&lt;/li&gt;
&lt;li&gt;最著名的，被许多大牌网站使用（或许是因为它小而易于被接受）&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;优点：

&lt;ul&gt;
&lt;li&gt;它很小，你可以在使用之前通过读源代码来弄懂它。&lt;/li&gt;
&lt;li&gt;对你的服务端架构和文件结构都没有影响，可以只在页面的一小部分起作用，并不需要考虑整个页面。&lt;/li&gt;
&lt;li&gt;Jeremy就像一个禅宗大师，对所有的问题都很有观点。他就像一个大人指导着一群吵闹的孩子。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;项目地址：&lt;a href=&quot;https://github.com/documentcloud/backbone/&quot;&gt;GitHub&lt;/a&gt; ，&lt;a href=&quot;http://backbonejs.org/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;发布时间：两年前&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Meteor&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者：Meteor开发团队，他们刚刚获得了1120万美元的融资所以可以全职开发Meteor&lt;/li&gt;
&lt;li&gt;内容：

&lt;ul&gt;
&lt;li&gt;这是一个来自未来世界的令人惊讶的框架，它拥有你所没有见过的东西（可能除了&lt;a href=&quot;http://derbyjs.com/&quot;&gt;Derby&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;在服务端（Node.js + Mongo）和客户端使用相同的代码，使二者(包括数据库）连通起来.通过WebSockets来同步服务端和所有的客户端。&lt;/li&gt;
&lt;li&gt;当修改代码时就可以“实时部署”——客户端会快速更新而不会丢失他们的内容。&lt;/li&gt;
&lt;li&gt;如果提供视频观看会更加合适【&lt;a href=&quot;http://www.meteor.com/screencast&quot;&gt;演示&lt;/a&gt;】&lt;/li&gt;
&lt;li&gt;和其他的人一样，我真心希望这个项目会成功——WEB开发需要一些像这样有激情的项目来向前推进。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;优点：当你收购了web开发的一些陈规旧俗，Meteor可以让你走在前沿。&lt;/li&gt;
&lt;li&gt;项目地址： &lt;a href=&quot;https://github.com/meteor/meteor&quot;&gt;GitHub&lt;/a&gt;,&lt;a href=&quot;http://www.meteor.com/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;发布时间：仍是早期版本，目前我不知道有哪些网站正式使用Meteor。但是它的核心团队正在认真地做着这个项目。&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Ember&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者: Yehuda Katz (Rails和Jquery的先前开发者),Ember团队已经 Yehuda 的伙伴Tilede&lt;/li&gt;
&lt;li&gt;内容:

&lt;ul&gt;
&lt;li&gt;它包含建立一个&amp;quot;强大的Web应用&amp;quot;的一切,采用的是MIT许可&lt;/li&gt;
&lt;li&gt;在所有的框架中是功能最强大,当然库的大小也很大.&lt;/li&gt;
&lt;li&gt;它的着眼点在于怎样把怎样把一个页面分解成一个个有层次的控件,然后通过一个有状态的路由系统来连接起来.&lt;/li&gt;
&lt;li&gt;正在开发更加精细的数据接入类库(Ember.Data)&lt;/li&gt;
&lt;li&gt;会在运行时对所有的页面控制,因此对于使用了很多内容的部分(如silverlight,ajax,flash)可能不合适.&lt;/li&gt;
&lt;li&gt;文件结构和URL都是固定的,但是可以被重写.&lt;/li&gt;
&lt;li&gt;其设计灵感来自Rails和Cocoa&lt;/li&gt;
&lt;li&gt;使用:它为Rails提供工程模版(你也可以通过手动配置来使它应用在别的服务端技术上)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;优点:常见的问题应该有常见的解决方法--Ember提供了所有的常见解决方案,你只需要考虑对你的应用程序来说那个是适用的.&lt;/li&gt;
&lt;li&gt;项目地址&lt;a href=&quot;https://github.com/emberjs/ember.js/&quot;&gt;GitHub&lt;/a&gt;,&lt;a href=&quot;http://emberjs.com/&quot;&gt;官网&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;开始时间: 仍然不是1.0的发布版本,不过很快会发布,API到时候也会发布(**译者注:已经发布1.0的pre版本)&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;AngularJS&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者:google的开发者,主要是他们内部使用,并且采用MIT协议&lt;/li&gt;
&lt;li&gt;内容:

&lt;ul&gt;
&lt;li&gt;MVW(Model-View-Whatever )模式&lt;/li&gt;
&lt;li&gt;基于DOM的模版声明式绑定.&lt;/li&gt;
&lt;li&gt;内置基础的url路由和数据序列号&lt;/li&gt;
&lt;li&gt;工具:他们实现了一个可以让你在调试时监视你的数据模型的chrome的调试插件,以及一个针对Jasmine 测试框架的插件&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;优点:

&lt;ul&gt;
&lt;li&gt;按照他们所宣传的，这是一个未来浏览器会原生支持的框架，所以我们应该现在就用这种方式来编程。&lt;/li&gt;
&lt;li&gt;对服务器端的架构和文件结构没有影响，可以用在不需要对整个页面控制的小部分。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;项目地址： &lt;a href=&quot;https://github.com/angular/angular.js&quot;&gt;GitHub&lt;/a&gt;,&lt;a href=&quot;http://angularjs.org/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;开始时间：已发布（曾在google使用过）&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Knockout&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者： Knockout团队和社区（包括我在内目前核心团队有三个成员）&lt;/li&gt;
&lt;li&gt;内容：

&lt;ul&gt;
&lt;li&gt;Model-View-ViewModel (MVVM) in JavaScript, MIT licensed&lt;/li&gt;
&lt;li&gt;关注与富UI：基于DOM的声明式绑定，拥有自动依赖检测的&amp;quot;观察者“模型&lt;/li&gt;
&lt;li&gt;不强制绑定URL路由和数据——和其他第三方库结合（例如使用Sammy.js做路由，采用ajax方式存储数据）。&lt;/li&gt;
&lt;li&gt;着重关注于易用性，有大量的文档和&lt;a href=&quot;http://learn.knockoutjs.com/&quot;&gt;交互的例子&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;特点：

&lt;ul&gt;
&lt;li&gt;专注于UI,支持IE6&lt;/li&gt;
&lt;li&gt;对服务器架构和文件系统没有影响。可以用在不需要对整个页面控制的小部分。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;项目地址： &lt;a href=&quot;https://github.com/SteveSanderson/knockout&quot;&gt;GitHub&lt;/a&gt;,&lt;a href=&quot;http://knockoutjs.com/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;开始时间： 发布将近两年&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Spine&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者： Alex MacCaw&lt;/li&gt;
&lt;li&gt;内容：

&lt;ul&gt;
&lt;li&gt;MVC in JavaScript, MIT license&lt;/li&gt;
&lt;li&gt;最初作为O’Reilly一本书的示例代码，最终演变为一个开源代码工程&lt;/li&gt;
&lt;li&gt;是Backbone的一个克隆版本（就像名字那样）（&lt;strong&gt;译者注：Spine和Backbone都有脊柱的意思&lt;/strong&gt;)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;特点：你希望用不同的方式来使用Backbone&lt;a href=&quot;http://stackoverflow.com/questions/6530444/backbone-js-vs-spine-js&quot;&gt;&lt;strong&gt;二者不同可以参看这里&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;项目地址： &lt;a href=&quot;https://github.com/maccman/spine&quot;&gt;GitHub&lt;/a&gt;,&lt;a href=&quot;http://spinejs.com/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;开始时间： 已经发布1.0.0版本&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Batman&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者：Shopify团队（一个电子商务平台公司）&lt;/li&gt;
&lt;li&gt;内容：

&lt;ul&gt;
&lt;li&gt;支持Javascript的MVC架构，几乎是为Rails+CoffeeScript开发者设计的。MIT 许可&lt;/li&gt;
&lt;li&gt;定制性最强的一个框架，你必须按照它的约定（例如文件结构和URL路径），否则，就像它”高傲“的作者们所说的：“不遵循约定就别用”。
*全栈式的框架，拥有丰富的模型，视图和控制器及路由。当然也有观察模式的机理。
*基于DOM的模版&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;特点： 如果你使用Rails和CoffeeScript，你会得心应手……&lt;/li&gt;
&lt;li&gt;项目地址： &lt;a href=&quot;https://github.com/Shopify/batman&quot;&gt;GitHub&lt;/a&gt;,&lt;a href=&quot;http://batmanjs.org/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;开始时间：目前是0.9版，预计在未来几个月内发布1.0版本。&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;CanJS&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;作者：bitovi团队（一个js咨询培训公司）&lt;/li&gt;
&lt;li&gt;内容：

&lt;ul&gt;
&lt;li&gt;MVC in JavaScript, MIT licensed&lt;/li&gt;
&lt;li&gt; REST-persistable模型，基础的路由，基于字符串的模版。&lt;/li&gt;
&lt;li&gt;并不很出名（我在上周前还不知道它），尽管它是一个很老的javascript mvc项目的重新开放。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;特点：致力于构建一个轻量的，提供上述所有框架都具有功能特性的最好的框架。&lt;/li&gt;
&lt;li&gt;项目地址： &lt;a href=&quot;https://github.com/jupiterjs/canjs&quot;&gt;GitHub&lt;/a&gt;,&lt;a href=&quot;http://canjs.us/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;总结&lt;/h4&gt;

&lt;p&gt;如果你在考虑究竟那个是最适合你的项目，我觉得应该考虑两个方面：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;应用范围&lt;/strong&gt;： 你希望一个框架或者类库能够帮助你做多少东西？你是希望有一个可以让你从0开始全程都为你提供架构帮助的全能框架，还是希望自己定制模式和类库？不管选择那种，对不同的项目和团队都是有价值的。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;设计美学&lt;/strong&gt;：你是否看过这些框架并且想自己构建一个小型的类库？你喜欢这样做吗？不要根据局限与描述或者功能列表去选择。忽略你自己的编码习惯就像仅仅根据小说的目录去买书或者是根据个人简历和履历来选择配偶。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;除了不同的地方，我可以肯定上述这些技术都遵循的一个功能：模型和视图分离。这是一种在20年钱就已经存在的经典设计模式。即使你在构建最简单的web应用界面你也能从这种模式中受益。&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>rails与sinatra，各自应用领域的佼佼者？</title>
   <link href="http://tom.preston-werner.com/2012/10/18/sinatra-vs-rails.html"/>
   <updated>2012-10-18T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/10/18/sinatra-vs-rails</id>
   <content type="html">&lt;h3&gt;Rails or Sinatra: The Best of Both Worlds?&lt;/h3&gt;

&lt;h5&gt;rails与sinatra，各自应用领域的佼佼者？&lt;/h5&gt;

&lt;p&gt;这是一篇翻译文章，原文在&lt;a href=&quot;http://rubysource.com/rails-or-sinatra-the-best-of-both-worlds/&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;

&lt;!--break--&gt;

&lt;h3&gt;正文：&lt;/h3&gt;

&lt;p&gt;近些年，ruby世界里涌现了众多优秀的网络开发框架，其中两个优秀的框架成了ruby在web开发领域的领头羊。&lt;/p&gt;

&lt;p&gt;本网站（指&lt;a href=&quot;http://rubysource.com&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://rubysource.com&lt;/a&gt;)的大多数读者可能听说过Ruby on Rails：它是David Heinemeier Hansson（DHH）在2004年开发出来的号称可以提供开发效率并能让开发者愉快地编程的MVC框架；&lt;br/&gt;
而Sinatra是由 Blake Mizerany在2007年开发出来的基于Rack之上带有轻量级的HTTP请求方式的领域特定语言（DSL)。&lt;br/&gt;
二者的共同特点就是简约而优雅。&lt;br/&gt;
通过 RubyGems.org的统计数据你就能看的这两个框架有多么受欢迎：Rails有700万的下载量而Sinatra也高达150万。&lt;/p&gt;

&lt;p&gt;我之所以使用Ruby做网络开发是被Rails吸引，但是最近几年我更多是在使用Sinatra（&lt;a href=&quot;http://rubysource.com/7-things-i-love-about-sinatra/&quot;&gt;我喜欢sinatra的七个原因&lt;/a&gt;）。&lt;/p&gt;

&lt;p&gt;事实上我觉得Sinatra结合几个常用的gem就能满足我开发应用的需求。&lt;br/&gt;
这也是让我怀疑Sinatra是否适用于所有的项目。&lt;br/&gt;
那么什么时候用Sinatra什么时候用Rails呢？为了找到答案我问了几个Ruby的大牛。&lt;/p&gt;

&lt;p&gt;Konstantin Haase 是Sinatra当前的维护者，他觉得这两个框架是为了满足不同类型应用的需求。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    尽管有重复和叠加之嫌，它们确实是在解决不同的问题。Rails关注于变形模型驱动的程序，而Sinatra是一个在服务器端处理HTTP消息的类库。如果你想处理HTTPS请求/响应，那么Sinatra是理想的工具；而如果你要处理一个大集成并且需要引入尽可能多地模版时，Rails是不二之选。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;DHH 也觉得二者之间有区别，他觉得是你的应用程序的规模决定哪个框架更适合些。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    Sinat对应小型应用来说是很棒的，Rails却不是。如果你从小型应用来比较，Sinatra要优于Rails；但是如果是大型的程序，Rails要胜于Sintra。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;事实上，大部分人认同Rails适合大型工程项目而Sinatra适合小型应用或者API.DHH还说了一个选择Sintra还是Rails的经验：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    如果你的程序只有5到10个接口，使用Sinatra会很方便，毕竟如果你程序的核心部分代码不超过一两个代码页那么还是放在一起好。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Github的Rich Olson 也认为Sinatra确实让小型应用变得更加优秀。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    Sinatra在API和小网站（内部应用，GitHub Jobs，等等）上表现的十分完美。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;DHH 解释为什么Rails构建大型的网络应用时是一个更好的选择：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    Rails成功的很大部分原因是它让程序员可以精挑细选最好的技术（“最好”是被我和Rails社区所定义的）……
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    我每周都修改Rails使它向我认为完美的框架改进。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Konstantin Haase分享了他自己对Rails的热爱以及他对rails哲学的认识。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;我喜欢Rails。Rails改变了我们对网络应用的认识。Rails解决的问题许多Sinatra无法解决，因为它为你的应用程序提供了更多的假设。它为你设置了所有的东西而不管你是否会用得到。所以Rails架构上最大的特点就是假设所有的问题都可以用一个工具来解决。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;我们并不会说在Rails包含了很多我们不需要的东西，反而会觉得在使用它时会获得我们真正想要的东西。这很划算的，特别是我们在构建一个大的项目时。但是并不是所有人都觉得Rails是大型应用的唯一选择的观点， Peepcode Screencasts的Geoffrey Grosenbach 认为这种观点“是过时的，只适用2008年前的Sinatra而不是现在”。他特别指出了一个用Sinatra搭建的优秀应用：Gaug.es用来说明Sinatra在大型网站上的应用是非常胜任的。&lt;/p&gt;

&lt;p&gt;尽管如此，Konstantin Haase指出了使用Sinatra构建大型应用的一个可能的问题：&lt;br/&gt;
        写一个复杂的Sinatra程序（或者一个在Sinatra中加入了其他的东西）要求开发者花费更多的时间去考虑架构和工具。这是有利也有弊。&lt;/p&gt;

&lt;p&gt;有的开发者可能觉得这是一个优势因为他们可以紧紧地控制他们程序里的内容并且知道程序的各个模块是如何联系起来的。Geoffrey Grosenbach认为这需要权衡是否需要这样：&lt;br/&gt;
        使用Sinatra最大的好处是它的稳定，你需要在Rails简便的迁移（generarors）工具和自己的设计之间权衡。使用Sinatra可以让开发者和商业应用一个稳定的API因为这个框架基本上不会改变。你对你的程序有完全的掌控并且可以自己决定什么时间改变它。&lt;/p&gt;

&lt;p&gt;他还觉得在一些情况下Sinatra是一个完美的候选方案：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    我所有的新应用程序都是用Sinatra做的，我发现除了几个Rack的插件、一个简单的CouchDB库和负责前端的Backbone.js外我几乎不需要更多的工具就可以完成。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;雅虎员工以及Cloning Internet Applications with Ruby作者Sau Sheong Chang持有相同的观点：&lt;br/&gt;
        Sinatra完全满足我对一个基础框架的需求，我需要的其他功能可以通过安装gem或者使用云平台上及其服务（比如heroku已经它所构建的插件生态系统）。剩下的东西我可以自己来编写。&lt;/p&gt;

&lt;p&gt;实际上，这种观点可以进一步上升为：你可以用Sinatra定制出完全符合你自己需求的框架。使用Sinatra并结合一些你需要的gem插件来构建你自己定制的框架。事实上， Padrino project 这个框架就是采用这种方式。&lt;/p&gt;

&lt;p&gt;DDH 却并不认同这种方式：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    把所有的东西分成很细小的部分然后让开发者自己去集成和Rails的理念已及Rails获得web框架好评的原因相悖。我们花费了大量的时间才做到这一点。尝试去重新做它并不是明智之举。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Konstantin Haase提醒说：尽管可以完全决定在应用程序中使用哪些技术和类库很棒，你却需要花费很多时间来完成它。&lt;br/&gt;
        Sinatra没有为使用者解决的问题就是它没有为你解决问题。你必须自己处理这些问题，可能要花费很多时间来处理它。&lt;/p&gt;

&lt;p&gt;如果预算很少，开发人员可能不会对这一点（耗费的时间）有很好的控制。DHH担心使用Sinatra会是在浪费时间来重复发明轮子：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;Sinatra给你的便利可能很快会被你必须复制Rails中已经提供的方法所抵消。我很同情那些想仅仅使用Sinatra来搭建类似 Basecamp，GitHub，Shopify之类的网站程序。Rails之所以复杂庞大是因为它包含了解决构建这类大型应用所遇到的大部分问题的方法。想要重新构建这些解决方案的“简洁”奉行者的做法并不简洁。&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Railscasts的制作者Ryan Bates认为使用Rails的好处就是为一个项目从构想到实现节省很多时间：&lt;br/&gt;
    Rails应用程序的默认配置提供了我在Sinatra中需要扩展安装的功能，这让使用Rails的开发变得更加快速。&lt;/p&gt;

&lt;p&gt;Rick Olson也认为是Rails的帮助才让GitHub从构想到诞生变得更加容易。&lt;br/&gt;
    我觉得Rails是GitHub创建者在第一年开发中的一个主要的有利工具，他们可以充分利用Rails高水平的功能并且快速迭代。&lt;/p&gt;

&lt;p&gt;Chad Fowler(Ruby技术大会的联合组织者）所引述的Rails理念：“约定优于配置”是Rails为什么加快大型项目的开发速度的另一个原因：&lt;br/&gt;
    Rails的生成器和结构提供了Sinatra所没有的便利。&lt;/p&gt;

&lt;p&gt;Rick Olson也指出这种约定有时候会让人觉得像是一些枷锁：&lt;br/&gt;
    只有你认同了Rails“指定”的约定，Rails才是适合你的黄金之路。&lt;/p&gt;

&lt;p&gt;作为对照，Sinatra对使用没有任何限制。 Satish Talim 在 Ruby Learning上引述Aaron Quint 说的话：&lt;br/&gt;
        Sinatra坚持这样的理念：我们不需要令人生厌的模式（WDNNSP:We Don’t Need No Stinking’ Pattern),这意味着Sinatra可以灵活地使用，Sinatra也没用限制你用什么方式去组织你自己的领域或者业务逻辑。它没有规定的文件夹结构，没有默认的数据库抽象层，对你在什么地方和怎么使用都没有限制。&lt;/p&gt;

&lt;p&gt;Sinatra受欢迎的很大原因是它能够让你用任何方式来组织应用程序。Sinatra让你可以不受工程大小、架构和工作流程的限制而自由使用。你可以构建一个API或者网络应用程序或者把你的程序打包成一个gem。&lt;/p&gt;

&lt;p&gt;有些人听到DHH是Sinatra精简主义的粉丝可能会吃惊：&lt;br/&gt;
    我以前用过Sinatra并且也很喜欢它，它提供了一个针对小领域问题的完全不同的方法，并且做到很好。&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>这些日子</title>
   <link href="http://tom.preston-werner.com/2012/04/17/thosedays.html"/>
   <updated>2012-04-17T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/04/17/thosedays</id>
   <content type="html">&lt;h3&gt;首先是我把我的毕业设计作为一个开源项目发布。&lt;/h3&gt;

&lt;p&gt;我给它起名为GeoInker,中文可以读成&amp;quot;脚印客&amp;quot;。源代码、系统架构等详细的情况可以看看这个项目的主页:&lt;br/&gt;
&lt;a href=&quot;http://geoinker.com&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://geoinker.com&lt;/a&gt;和我的一篇博客&lt;a href=&quot;http://www.shiyj.tk/2012/04/16/geoinker/&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://www.shiyj.tk/2012/04/16/geoinker/&lt;/a&gt;，这里只简单说一下：&lt;/p&gt;

&lt;!--break--&gt;

&lt;ul&gt;
&lt;li&gt;GeoInker是想做为一个为移动GIS提供解决方案的平台，目前只在android平台上测试和开发。&lt;/li&gt;
&lt;li&gt;GeoInker内包含了一个空间数据库系统，可以解决GIS的数据问题。&lt;/li&gt;
&lt;li&gt;GeoInker为了开发方便，使用的是HTML+CSS+JavaScript作为UI表现层，深入的还有Java和C/C++做支持，&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;有对这方面感兴趣的同学可以一同来开发它。&lt;/p&gt;

&lt;h3&gt;其次是我到武汉了，&lt;/h3&gt;

&lt;p&gt;如果没有什么变故的话（比如我试用期未满就被开除——和我一起的已经有这样的例子，比如这个公司倒闭，比如我上了寻找OnePiece的海贼船……），今后可能就留在江城了。&lt;/p&gt;

&lt;p&gt;想想当初选择武汉的原因似乎也并不明确，可能仅仅是：来到这里、被众多公司笔试面试得身心俱疲、然后就像扔硬币那样非此即彼地选择了……&lt;/p&gt;

&lt;p&gt;如今到这儿一个月了,工作、生活上的各种不如意也消去了很多。前几天在一饭店吃饭，大厅里挂了一幅大概是说勤劳什么的书法横幅，我对书法欣赏“不动”，就看落款上面写着“楚人某某“，顿时意识到武汉属于“楚地“。先前读诗读到一句“怀璧莫向楚，楚少别玉人“仅仅一笑而过，而今自己怀璧至楚，才晓得什么叫“门非植兰所“……&lt;/p&gt;

&lt;p&gt;不识璞玉的恐怕不止楚地，而是天下吧，看不到力拔山气盖世，听不到凤歌笑孔丘……&lt;/p&gt;

&lt;p&gt;人生不应该如此！&lt;/p&gt;

&lt;h3&gt;最后说说创业的事。&lt;/h3&gt;

&lt;p&gt;前一段时间读了37signals的两本书：Rework 和 Getting Real，被这个团队的意气风发所鼓舞。&lt;/p&gt;

&lt;p&gt;这是我看到的最让人兴奋的书，更何况，其成员之一，Ruby on Rails的作者DHH，的人生也是颇具传奇让人向往的。&lt;br/&gt;
&lt;a href=&quot;http://robbin.iteye.com/blog/963959&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://robbin.iteye.com/blog/963959&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://celebrity.group.iteye.com/group/wiki/291-ruby-on-rails-founder-david-heinemeier-hansson&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://celebrity.group.iteye.com/group/wiki/291-ruby-on-rails-founder-david-heinemeier-hansson&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;然后就是最近FaceBook以10亿收购了仅13人的小公司Instagram，让人无限感慨……&lt;/p&gt;

&lt;p&gt;其实关于创业，想的很多，但能说出来的内容却很少，再加上人们到处隐藏自己的想法，真真幻幻之中连自己都被自己骗过去了。&lt;br/&gt;
如果我认真地问：你的梦想是什么？支持你在困难时坚持下去的信仰是什么？你能回答上来吗？&lt;br/&gt;
动漫《海贼王》里路飞正在寻找第十个伙伴，你觉得你的梦想和信念能支撑你走过伟大航路，走过新世界吗？&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>开源移动GIS解决方案--GeoInker发布</title>
   <link href="http://tom.preston-werner.com/2012/04/16/geoinker.html"/>
   <updated>2012-04-16T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/04/16/geoinker</id>
   <content type="html">&lt;h3&gt;我的第一个开源程序GeoInker发布!&lt;/h3&gt;

&lt;h4&gt;项目地址:&lt;a href=&quot;https://github.com/shiyj/GeoInker&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;https://github.com/shiyj/GeoInker&lt;/a&gt;&lt;/h4&gt;

&lt;h4&gt;项目主页:&lt;a href=&quot;http://geoinker.com&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://geoinker.com&lt;/a&gt;&lt;/h4&gt;

&lt;!--break--&gt;

&lt;h3&gt;简介&lt;/h3&gt;

&lt;p&gt;GeoInker 是我的毕业设计,目标是搭建一个移动GIS平台,为各个行业应用提供在移动平台上的解决方案.&lt;/p&gt;

&lt;p&gt;目前开发的平台只有Android ,不过平台采用到特殊架构方式很容易就可以迁移到Windows Phone,iso等平台,&lt;br/&gt;
这后边我详细介绍.&lt;br/&gt;
如果感兴趣可以在github上follow,下边介绍下它目前的开发状况、架构、功能等:&lt;/p&gt;

&lt;h3&gt;GeoInker目前开发状况&lt;/h3&gt;

&lt;p&gt;GeoInker目前仅仅刚刚搭建好框架,功能不稳定,界面不美观,运行效率低下...&lt;/p&gt;

&lt;p&gt;但是,内涵很丰富,具体表现在以下两点:&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;1.GeoInker 在移动平台上实习了空间数据库功能,即可以将空间数据存储在关系数据库中,并对其索引、查询和分析.&lt;/li&gt;
&lt;li&gt;2.GeoInker 的UI层采用的是HTML元素结合CSS和Javascript来实现,这就是为什么我上边说&amp;quot;很容易迁移到其他平台&amp;quot;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;

&lt;p&gt;针对第一点,它可以实习复杂的GIS操作,如空间拓扑关系,空间分析,空间索引.当然也包括最基本的增删改查.&lt;br/&gt;
使用过如PostGIS和Oracke Spatial的应该都很清楚空间数据库是怎么回事.&lt;br/&gt;
GeoInker采用的是Spatilite数据库,简单、轻巧而功能丰富.&lt;/p&gt;

&lt;p&gt;针对第二点,其带来的好处就是更轻松的平台移植,不过仍不能达到完全的&amp;quot;write once run anywhere&amp;quot;，&lt;br/&gt;
根据需求的不同，也需要大量的中间件来填补差异。当然也不仅仅是平台移植方便，&lt;br/&gt;
采用JS+HTML+CSS的开发方式其技术上的门槛就很低了。&lt;/p&gt;

&lt;p&gt;但是这两个特点带来了一个很大到问题：&lt;strong&gt;&lt;em&gt;程序的效率极低！！！&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;对于第一点是受限于移动平台本身的处理能力，这方面可以在查询和处理数据的方法上做改善，&lt;br/&gt;
但是改善空间不大。&lt;/p&gt;

&lt;p&gt;对于第二点效率问题就更加突出,在移动平台本身的处理能力达不到要求的情况下，&lt;br/&gt;
还要用程序内嵌的浏览器去渲染更加复杂的空间数据，&lt;br/&gt;
无异于笨熊戴着镣铐去跳舞……&lt;/p&gt;

&lt;p&gt;不过我对这些还是比较乐观的，毕竟科技的速度是你无法想像的，&lt;br/&gt;
更何况在实施这个项目时所锻炼处出来的东西应该超过这个项目本身。&lt;br/&gt;
&lt;strong&gt;那么还犹豫什么?一同开发它吧!!!&lt;/strong&gt;&lt;br/&gt;
下面说一下开发它大致需要什么样的知识和背景,你看下这些东西是否是你感兴趣的.&lt;/p&gt;

&lt;h3&gt;需要具备的知识:&lt;/h3&gt;

&lt;h4&gt;1.需要熟悉的开发环境&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;操作系统: Ubuntu 系列&lt;/li&gt;
&lt;li&gt;IDE: Eclipse &lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;2.需要掌握的编程语言&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;javascript (必须)
javascript 用来做UI和一些数据绑定获取显示等操作.
目前用到的类库是处理界面的Sencha Touch和处理GIS数据的openlayers，
这两个需要掌握.
此外GeoInker的后台服务我准备使用Node.js+MongoDB，
javascript在后台也是可以大有作为的。&lt;/li&gt;
&lt;li&gt;Java (了解)
Android的dalvik虚拟机采用的是Java运行时,
如果你想调用它的内容如声音震动、联系人列表、文件列表等就必须要知道点Java。
不过并不需要你去了解J2EE之类的工程级应用，简单到调用接口即可。&lt;/li&gt;
&lt;li&gt;C/C++（选用）
Android是基于Linux的，所以原生的C/C++代码是可以运行在其中的，
这也是GeoInker实现空间数据库的方法，不过大部分内容都是利用Spatialite现有的东西，
需要自己写的并不多，所以C/C++在这个项目里如果想深入需要用到，但不用也可以满足需求。&lt;/li&gt;
&lt;li&gt;git
git不算是一门语言，它是一个版本控制器，如果你也想参与到GeoInker的话这个是必需的（所幸git也是很简单的），
如果只是想看看源代码作为正面或反面教材，嘿嘿，就用不到这个。
不过提醒下，git是Linux的发起人Linus Torvalds继Linux后的另一开源项目，
其“威望“可想而知。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;最后&lt;/h3&gt;

&lt;p&gt;其实准备GeoInker很长时间了，一直都在忙它的功能实现但总是有这样那样的问题迟迟不能发布。&lt;br/&gt;
包括现在它仍然是一个BUG丛生的程序，不过我想总该有一个开始吧，&lt;br/&gt;
总该把以前的包袱扔掉接受新鲜的事物。&lt;br/&gt;
西西弗斯的悲剧是日夜地重复，我性格上的弱点多少也有这点封闭、自卑的重复。&lt;br/&gt;
我希望的是一个新的开始，新的开放的环境……&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ubuntu 下 PostGIS 的配置.</title>
   <link href="http://tom.preston-werner.com/2012/02/29/postgisinit.html"/>
   <updated>2012-02-29T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/02/29/postgisinit</id>
   <content type="html">&lt;h3&gt;0.安装postgresql,并配置密码等&lt;/h3&gt;

&lt;p&gt;详细可以看这里&lt;a href=&quot;http://wiki.ubuntu.org.cn/PostgreSQL&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://wiki.ubuntu.org.cn/PostgreSQL&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;1.安装postgis.&lt;/h3&gt;

&lt;p&gt;我的环境是ubuntu 10.04,安装的是postgresql-8.4.&lt;br/&gt;
在新立得软件安装包中找到postgis和postgresql-8.4-postgis(不同的版本对应不同到包)这两个包,标记安装.&lt;br/&gt;
安装完成后在postgresql-8.4-postgis这个包到属性里,&amp;quot;已安装的文件&amp;quot;选项卡下有这么几个重要到信息&lt;/p&gt;

&lt;!--break--&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;/usr/share/postgresql/8.4/contrib/postgis-1.5/postgis.sql
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;/usr/share/postgresql/8.4/contrib/postgis-1.5/spatial_ref_sys.sql&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;我们待会会用到它们.&lt;/p&gt;

&lt;h3&gt;2.配置空间数据库&lt;/h3&gt;

&lt;h4&gt;2.1创建一个数据库&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;首先进入postgresql到管理用户中   &lt;code&gt;su postgres&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;创建一个pg数据库:  &lt;code&gt;createdb geotemplate&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;然后进入这个数据库:  &lt;code&gt;psql geotemplate&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;创建一个数据表:  &lt;code&gt;create table test(id int,name varchar(25));&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;输入 &lt;code&gt;\q&lt;/code&gt; 退出数据库&lt;/li&gt;
&lt;li&gt;输入 &lt;code&gt;createlang plpgsql geotemplate&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;导入postgis为数据库准备到空间插件postgis.sql和spatial&lt;em&gt;ref&lt;/em&gt;sys.sql.首先进入所在到文件夹下:  &lt;code&gt;cd /usr/share/postgresql/8.4/contrib/postgis-1.5&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;导入postgis功能函数:  &lt;code&gt;psql -d geotemplate  -f postgis.sql&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;导入空间参照系:   &lt;code&gt;psql -d geotemplate  -f spatial_ref_sys.sql&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;然后进入geotemplate查看其中到内容(表中的内容解释看后续到介绍):&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;postgres@engin-laptop:~$ psql geotemplate
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;psql (8.4.10)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;输入 &amp;quot;help&amp;quot; 来获取帮助信息.
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;geotemplate=# \d
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;                       关联列表
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt; 架构模式 |       名称        |  型别  |  拥有者  
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;----------+-------------------+--------+----------
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt; public   | geography_columns | 视观表 | postgres
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt; public   | geometry_columns  | 资料表 | postgres
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt; public   | spatial_ref_sys   | 资料表 | postgres
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt; public   | test              | 资料表 | postgres
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;(4 行记录)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;geotemplate=# \d geometry_columns
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;            资料表 &amp;quot;public.geometry_columns&amp;quot;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;         栏位        |          型别          | 修饰词 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;-------------------+------------------------+--------
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt; f_table_catalog   | character varying(256) | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt; f_table_schema    | character varying(256) | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt; f_table_name      | character varying(256) | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt; f_geometry_column | character varying(256) | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt; coord_dimension   | integer                | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt; srid              | integer                | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt; type              | character varying(30)  | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;索引：
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;      &amp;quot;geometry_columns_pk&amp;quot; PRIMARY KEY, btree (f_table_catalog, f_table_schema, f_table_name, f_geometry_column)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;geotemplate=# \d spatial_ref_sys
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;         资料表 &amp;quot;public.spatial_ref_sys&amp;quot;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;     栏位    |          型别           | 修饰词 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;-----------+-------------------------+--------
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n33&quot; name=&quot;n33&quot;&gt;33&lt;/a&gt;&lt;/span&gt; srid      | integer                 | 非空
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n34&quot; name=&quot;n34&quot;&gt;34&lt;/a&gt;&lt;/span&gt; auth_name | character varying(256)  | 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n35&quot; name=&quot;n35&quot;&gt;35&lt;/a&gt;&lt;/span&gt; auth_srid | integer                 | 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n36&quot; name=&quot;n36&quot;&gt;36&lt;/a&gt;&lt;/span&gt; srtext    | character varying(2048) | 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n37&quot; name=&quot;n37&quot;&gt;37&lt;/a&gt;&lt;/span&gt; proj4text | character varying(2048) | 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n38&quot; name=&quot;n38&quot;&gt;38&lt;/a&gt;&lt;/span&gt;索引：
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n39&quot; name=&quot;n39&quot;&gt;39&lt;/a&gt;&lt;/span&gt;      &amp;quot;spatial_ref_sys_pkey&amp;quot; PRIMARY KEY, btree (srid)&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;####2.2增加空间数据列&lt;br/&gt;
    geotemplate=# select AddGeometryColumn(&amp;#39;test&amp;#39;,&amp;#39;location&amp;#39;,4236,&amp;#39;POINT&amp;#39;,2);&lt;br/&gt;
    -[ RECORD 1 ]-----+--------------------------------------------------&lt;br/&gt;
    addgeometrycolumn | public.test.location SRID:4236 TYPE:POINT DIMS:2 &lt;br/&gt;
####2.3增加空间数据项&lt;br/&gt;
    geotemplate=# insert into test(id,name,location) values&lt;br/&gt;
    (1,&amp;#39;virtual place&amp;#39;,GeomFromText(&amp;#39;POINT(-10 10)&amp;#39;,4236));&lt;br/&gt;
    INSERT 0 1&lt;/p&gt;

&lt;p&gt;查询后如下(即将空间数据写入了其中并存储为二进制文件):&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;geotemplate=# select * from test;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;-[ RECORD 1 ]------------------------------------------------
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;id       | 1
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;name     | virtual place
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;location | 01010000208C10000000000000000024C00000000000002440&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>codehighlighter里中文乱码问题</title>
   <link href="http://tom.preston-werner.com/2012/02/22/codehighliterfix.html"/>
   <updated>2012-02-22T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/02/22/codehighliterfix</id>
   <content type="html">&lt;p&gt;在toto博客中使用了 codehighliter 这个gem来表现代码部分到html格式.&lt;br/&gt;
但是在代码中加入中文则出现乱码.&lt;/p&gt;

&lt;p&gt;本文介绍出现该问题到解决方法及我对该问题的追踪过程.&lt;/p&gt;

&lt;h3&gt;解决方法&lt;/h3&gt;

&lt;h4&gt;1.新建一个mylib.rb文件,写入下列代码:&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;module&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Rack&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Codehighlighter&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    include &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Utils&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;call&lt;/span&gt;(env)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;      began_at = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Time&lt;/span&gt;.now
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;      status, headers, response = &lt;span style=&quot;color:#33B&quot;&gt;@app&lt;/span&gt;.call(env)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;      headers = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;HeaderHash&lt;/span&gt;.new(headers)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; !&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;STATUS_WITH_NO_ENTITY_BODY&lt;/span&gt;.include?(status) &amp;amp;&amp;amp;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;      !headers[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;transfer-encoding&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;] &amp;amp;&amp;amp;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;      headers[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;content-type&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;] &amp;amp;&amp;amp;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;      headers[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;content-type&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;].include?(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;text/html&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;        content = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;        response.each { |part| content += part }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;        doc = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Nokogiri&lt;/span&gt;::HTML(content, &lt;span style=&quot;color:#069&quot;&gt;nil&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;UTF-8&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;        nodes = doc.search(&lt;span style=&quot;color:#33B&quot;&gt;@opts&lt;/span&gt;[&lt;span style=&quot;color:#A60&quot;&gt;:element&lt;/span&gt;])
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;        nodes.each &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;do&lt;/span&gt; |node|
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;          s = node.inner_html || &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;[++where is the code?++]&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;          &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#33B&quot;&gt;@opts&lt;/span&gt;[&lt;span style=&quot;color:#A60&quot;&gt;:markdown&lt;/span&gt;]
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#777&quot;&gt;#原代码为node.parent.swap(s)&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;            node.parent.swap(&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Nokogiri&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;XML&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;DocumentFragment&lt;/span&gt;.new(doc,send(&lt;span style=&quot;color:#33B&quot;&gt;@highlighter&lt;/span&gt;, s)))
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;          &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#777&quot;&gt;#原代码为node.swap(s)&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;            node.swap(&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Nokogiri&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;XML&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;DocumentFragment&lt;/span&gt;.new(doc,send(&lt;span style=&quot;color:#33B&quot;&gt;@highlighter&lt;/span&gt;, s)))
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;          &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;        body = doc.to_html
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;        headers[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;content-length&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;] = bytesize(body).to_s
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;        log(env, status, headers, began_at) &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#33B&quot;&gt;@opts&lt;/span&gt;[&lt;span style=&quot;color:#A60&quot;&gt;:logging&lt;/span&gt;]
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n33&quot; name=&quot;n33&quot;&gt;33&lt;/a&gt;&lt;/span&gt;        [status, headers, [body]]
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n34&quot; name=&quot;n34&quot;&gt;34&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n35&quot; name=&quot;n35&quot;&gt;35&lt;/a&gt;&lt;/span&gt;        [status, headers, response]
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n36&quot; name=&quot;n36&quot;&gt;36&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n37&quot; name=&quot;n37&quot;&gt;37&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n38&quot; name=&quot;n38&quot;&gt;38&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n39&quot; name=&quot;n39&quot;&gt;39&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;2.在config.ru中将刚刚添加到文件引用到其中然后就可以运行.&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;./mylib&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;     &lt;span style=&quot;color:#777&quot;&gt;#必须放在require 'rack/codehighlighter'之后&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;过程及原因.&lt;/h3&gt;

&lt;p&gt;codehighlighter 中引用了nokogiri,nokogiri是对html文件进行出来到一个类库,它是用c语言写成的.&lt;/p&gt;

&lt;p&gt;codehighlighter定义了解析格式,由nokogiri配合将markdown(或其他渲染)中这些格式转换成html标签和属性.&lt;/p&gt;

&lt;p&gt;但是 nokogiri 对解析中文字符串到解析有很多问题,并且这个问题用iconv貌似也解决不了.&lt;br/&gt;
例如 codehighlighter 使用到的swap()就是这个问题.&lt;br/&gt;
swap()在处理中文字符串时就无法解析,原因可能是起原生c代码到问题,但我懒得去看源代码,找不到究竟是什么原因.&lt;/p&gt;

&lt;p&gt;我在nokogiri的项目组提出了这个问题,有人告诉我swap在解析字符串时遇到的问题&lt;br/&gt;
在Nokogiri::XML::DocumentFragment中就不会出现.&lt;br/&gt;
详细可以看这里&lt;a href=&quot;https://github.com/tenderlove/nokogiri/issues/587&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;https://github.com/tenderlove/nokogiri/issues/587&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ruby实现文本博客引擎构建(二)</title>
   <link href="http://tom.preston-werner.com/2012/01/26/txtblog2.html"/>
   <updated>2012-01-26T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/01/26/txtblog2</id>
   <content type="html">&lt;h3&gt;4.配置路由&lt;/h3&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>phonegap plugin 的编写(android)</title>
   <link href="http://tom.preston-werner.com/2012/01/26/phonegapplugin.html"/>
   <updated>2012-01-26T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2012/01/26/phonegapplugin</id>
   <content type="html">&lt;h4&gt;Phonegap使用Javascript为不同移动开发提供了统一的接口,如调用本地GPS、摄像头、传感器等设备和本地存储等平台操作，但是如果我们想针对特殊的应用调用平台原生的代码库时如何制作插件呢？Phonegap为我们提供了编写平台原生代码的接口。&lt;/h4&gt;

&lt;h3&gt;0.问题描述：&lt;/h3&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;在android平台上有一个java写的类库，如何通过phonegap调用到该类库中的数据。&lt;/p&gt;

&lt;h4&gt;java(HelloWorld.java)文件内容：&lt;/h4&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;package&lt;/span&gt; &lt;span style=&quot;color:#707;font-weight:bold&quot;&gt;com.test&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color:#339;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;HelloWorld&lt;/span&gt; {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; sayHello(&lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; name){
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;hello world from: &lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;+name;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    }
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;1.修改原有java文件(HelloWorld.java)&lt;/h3&gt;

&lt;h4&gt;1.1引入所需包&lt;/h4&gt;

&lt;p&gt;首先必须在工程中添加phonegap.jar包，然后在HelloWorld.java中引入：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;com.phonegap.api.Plugin&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;com.phonegap.api.PluginResult&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;com.phonegap.api.PluginResult.Status&lt;/span&gt;;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;并让原有的类继承com.phonegap.api.Plugin类,&lt;br/&gt;
此外还需要android中的org.json包中的部分内容.&lt;/p&gt;

&lt;h4&gt;1.2继承Plugin&lt;/h4&gt;

&lt;p&gt;继承Plugin需要实现execute这个函数。&lt;br/&gt;
最终修改完成的代码如下：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;package&lt;/span&gt; &lt;span style=&quot;color:#707;font-weight:bold&quot;&gt;com.plugin.test&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;org.json.JSONArray&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;org.json.JSONException&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;org.json.JSONObject&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;android.util.Log&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;com.phonegap.api.Plugin&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;com.phonegap.api.PluginResult&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;import&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;com.phonegap.api.PluginResult.Status&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color:#339;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;HelloWorld&lt;/span&gt; &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;extends&lt;/span&gt; Plugin {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;final&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; ACTION =&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;hello&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#007&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;public&lt;/span&gt; PluginResult execute(&lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; action, JSONArray data, &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; callbackId) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;    PluginResult result = &lt;span style=&quot;color:#069&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt;(ACTION.equals(action)) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;      &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;try&lt;/span&gt; {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; name = data.getString(&lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;      JSONObject fileInfo = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; JSONObject();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;      fileInfo.put(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;hello&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, sayHello(name));
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;      result = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; PluginResult(Status.OK,fileInfo); 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;      } &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;catch&lt;/span&gt; (JSONException jsonEx) {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;      Log.d(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;HelloWorldPlugin&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Got JSON Exception &lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; + jsonEx.getMessage());
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;      }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;      } &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;else&lt;/span&gt; {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;      result = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; PluginResult(Status.JSON_EXCEPTION);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;      }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; result;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;  }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n33&quot; name=&quot;n33&quot;&gt;33&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;private&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; sayHello(&lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;String&lt;/span&gt; name){
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n34&quot; name=&quot;n34&quot;&gt;34&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;hello world from: &lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;+name;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n35&quot; name=&quot;n35&quot;&gt;35&lt;/a&gt;&lt;/span&gt;  }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n36&quot; name=&quot;n36&quot;&gt;36&lt;/a&gt;&lt;/span&gt;}
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;2.编写javascript接口&lt;/h3&gt;

&lt;p&gt;javascript接口很简单，只需要按照PhoneGap的规范就可以了：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt;  HelloWorld = {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;hello&lt;/span&gt;: &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt;(name,successCallback,failureCallback){
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;return&lt;/span&gt; PhoneGap.exec(successCallback,failureCallback,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;HelloWorld&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;hello&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,[name]);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;  }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;};
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;将其保存为hello.js放在 assert/www/ 目录下。&lt;/p&gt;

&lt;h3&gt;3.将该插件增加到phonegap的插件组中&lt;/h3&gt;

&lt;p&gt;在 res/xml/plugins.xml中的&lt;plugins&gt;&lt;/plugins&gt;标签内添加如下内容：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#070&quot;&gt;&amp;lt;plugin&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;name&lt;/span&gt;=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;HelloWorld&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;value&lt;/span&gt;=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;com.plugin.test.HelloWorld&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;4.在页面中调用&lt;/h3&gt;

&lt;p&gt;在主程序loadUrl的html文件中增加一个id=hello的button和id=result的div，并添加js调用代码：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;disabled&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;id&lt;/span&gt; = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;hello&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;type&lt;/span&gt;=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;button&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;value&lt;/span&gt;=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Hello&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span style=&quot;color:#070&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;lt;hr&amp;gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;id&lt;/span&gt;=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;result&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;lt;hr&amp;gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;lt;script&lt;/span&gt; &lt;span style=&quot;color:#b48&quot;&gt;type&lt;/span&gt;=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;text/javascript&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;  document.addEventListener(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;deviceready&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,bindEv,&lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;bindEv&lt;/span&gt;(){&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; btn = document.getElementById(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;hello&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;    btn.&lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;onclick&lt;/span&gt; = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt;() {&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;      HelloWorld.hello(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Shiyj&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt;(r){&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;        document.getElementById(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;result&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;).innerHTML=r.hello&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;      },&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt;(e){log(e)});&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;    }&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;    btn.disabled=&lt;span style=&quot;color:#069&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;background-color:hsla(0,0%,0%,0.07);color:black&quot;&gt;  }&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;&lt;span style=&quot;color:#070&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;5.流程介绍：&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/phonegap/phonegapplugin.png&quot; alt=&quot;流程介绍&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ruby实现的文本博客引擎构建(一)</title>
   <link href="http://tom.preston-werner.com/2011/12/06/txtblog.html"/>
   <updated>2011-12-06T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/12/06/txtblog</id>
   <content type="html">&lt;p&gt;本博客使用的是一个叫toto的文本博客引擎,&lt;br/&gt;
toto采用文本而不是数据库来存储数据,这样就省去数据库的开销,&lt;br/&gt;
完全使用静态文件渲染的方法来构建网站,&lt;br/&gt;
很适合挂在heroku中的免费项目下.&lt;/p&gt;

&lt;p&gt;本文是我研究toto代码并修改、实现的过程,暂时称之为txtblog.&lt;/p&gt;

&lt;h3&gt;1.先运行起来!&lt;/h3&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;要使自己的网站运行起来,即可以通过浏览器以http协议形式访问,我们需要Rack模块.&lt;br/&gt;
rack是一个标准的Ruby网络服务运行接口(a modular Ruby webserver interface).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;

&lt;p&gt;我们就用它来构建网站的第一步:&lt;/p&gt;

&lt;p&gt;要使rack运行起来,只需要一个包含call方法的类,在其中引入rack的requset和response就可以了.&lt;br/&gt;
如下为第一步:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;#/home/myhome/v1/txtblog.rb&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Server&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;call&lt;/span&gt; env
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@request&lt;/span&gt;  = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Request&lt;/span&gt;.new env
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt; = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Response&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;            body = [&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;&amp;lt;h1&amp;gt;hello world&amp;lt;/h1&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;&amp;lt;h2&amp;gt;This is a simple website.&amp;lt;/h2&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.body= body
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]   = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Mime&lt;/span&gt;.mime_type(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;.html&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Cache-Control&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;] = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;no-cache, must-revalidate&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.status = &lt;span style=&quot;color:#00D&quot;&gt;200&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.finish
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;然后定义config.ru内容&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;#/home/myhome/v1/config.ru  &lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;./txtblog&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    use &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;ShowExceptions&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    myserver = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Server&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    run myserver
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;接着在当前目录(config.ru所在目录)下运行 &lt;code&gt;thin start -p 3001&lt;/code&gt;,&lt;br/&gt;
在浏览器中打开 &lt;a href=&quot;http://localhost:3001&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://localhost:3001&lt;/a&gt; 即可看到返回的内容.&lt;/p&gt;

&lt;p&gt;以上即为一个简单的Web服务器,接下来我们希望能够读取出文件的内容来替换txtblog.rb中定义的body.&lt;/p&gt;

&lt;h3&gt;2.读取网站模板&lt;/h3&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;网站模板也可以说成是网站的&amp;quot;屏幕架子&amp;quot;,我们的博客内容就是屏幕里的画面.&lt;br/&gt;
此处使用的是可以嵌入ruby程序的html文件(rhtml),使用的ruby模块叫ERB(embedded ruby).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;

&lt;p&gt;为了便于控制我们将第一步中txtblog.rb中的Server类放在叫Txtblog的module中,&lt;br/&gt;
然后再在Txtblog中定义一个Site类来读取网站模板,并在Server类中引用它.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;module&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Txtblog&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Site&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;index&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;                title = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Index&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;ERB&lt;/span&gt;.new(&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;File&lt;/span&gt;.read(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;templates/layout.rhtml&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)).result(binding)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Server&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;initialize&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@site&lt;/span&gt; = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Txtblog&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Site&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;call&lt;/span&gt; env
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@request&lt;/span&gt;  = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Request&lt;/span&gt;.new env
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt; = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Response&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#777&quot;&gt;#body = [&amp;quot;&amp;lt;h1&amp;gt;hello world&amp;lt;/h1&amp;gt;&amp;quot;,&amp;quot;&amp;lt;h2&amp;gt;This is a simple website.&amp;lt;/h2&amp;gt;&amp;quot;]&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;            body = []
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;            body &amp;lt;&amp;lt; &lt;span style=&quot;color:#33B&quot;&gt;@site&lt;/span&gt;.index
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.body= body
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]   = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Mime&lt;/span&gt;.mime_type(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;.html&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Cache-Control&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;] = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;no-cache, must-revalidate&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.status = &lt;span style=&quot;color:#00D&quot;&gt;200&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.finish
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;这样,我们就成功地读取出来Erb文件中的内容并向其中&lt;em&gt;内嵌的title变量赋值&lt;/em&gt;.&lt;br/&gt;
运行&lt;code&gt;thin start -p 3001&lt;/code&gt;即可看到读取出来的结果.&lt;/p&gt;

&lt;p&gt;这里需要补充的是如果所读取的erb文件中包含静态的如css、javascript、图片,&lt;br/&gt;
需要在config.ru中引用rack的Static来设置网站的根目录.&lt;br/&gt;
下边的这段代码表示将public文件夹设置为根目录,其下的css,js,images文件夹为可访问目录.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    use &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Static&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:urls&lt;/span&gt; =&amp;gt; [&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;/css&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;/js&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;/images&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;/favicon.ico&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;], &lt;span style=&quot;color:#A60&quot;&gt;:root&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;public&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;例如:如果要引用css文件夹内的app.css,&lt;br/&gt;
只需指明路径 /css/app.css即可,而不是/public/css/app.css.&lt;/p&gt;

&lt;h3&gt;3.加载markdown&lt;/h3&gt;

&lt;p&gt;前边提到我们的博客是&amp;quot;文本&amp;quot;形式的,那么是不是写成包含html标签的文档呢?&lt;/p&gt;

&lt;p&gt;肯定不能那么繁杂,此处我们介绍一中类似html标签,却是更简洁的文本格式:markdown.&lt;br/&gt;
ruby中使用rdiscount这样一个gem可以实现将markdown转换为html标记.&lt;br/&gt;
关于markdown的详细规则可以参考其官网教程.&lt;/p&gt;

&lt;p&gt;我们重新修改代码如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;rdiscount&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;module&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Txtblog&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Server&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;initialize&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@site&lt;/span&gt; = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Txtblog&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Site&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;call&lt;/span&gt; env
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@request&lt;/span&gt;  = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Request&lt;/span&gt;.new env
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt; = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Response&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#777&quot;&gt;#body = [&amp;quot;&amp;lt;h1&amp;gt;hello world&amp;lt;/h1&amp;gt;&amp;quot;,&amp;quot;&amp;lt;h2&amp;gt;This is a simple website.&amp;lt;/h2&amp;gt;&amp;quot;]&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;                body = []
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;                body &amp;lt;&amp;lt; &lt;span style=&quot;color:#33B&quot;&gt;@site&lt;/span&gt;.index(&amp;amp;&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Proc&lt;/span&gt;.new{ &lt;span style=&quot;color:#33B&quot;&gt;@site&lt;/span&gt;.markdown })
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.body= body
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]   = &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Mime&lt;/span&gt;.mime_type(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;.html&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;[&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Cache-Control&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;] = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;no-cache, must-revalidate&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.status = &lt;span style=&quot;color:#00D&quot;&gt;200&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#33B&quot;&gt;@response&lt;/span&gt;.finish
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;Site&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;index&lt;/span&gt; &amp;amp;blk
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;                title = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Index--&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;ERB&lt;/span&gt;.new(&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;File&lt;/span&gt;.read(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;templates/layout.rhtml&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)).result(binding)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;markdown&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Markdown&lt;/span&gt;.new(&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;File&lt;/span&gt;.read(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;articles/test.md&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;)).to_html
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;          &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;需要声明的一点是在layout.rhtml中要加入&amp;lt;%= yield %&amp;gt;这样一句嵌入语句.&lt;br/&gt;
它表示将传给方法的代码块放入该位置来迭代.&lt;br/&gt;
我们通过Proc.new将markdown渲染出来的文本带入到index读取的模板中,&lt;br/&gt;
从而实现从&amp;quot;屏幕(框架)&amp;quot;中显示&amp;quot;影像(博客)&amp;quot;来.&lt;/p&gt;

&lt;h3&gt;总结&lt;/h3&gt;

&lt;p&gt;该部分只是简单地将文本引擎的流程描述出来,更细致的东西如路由响应等尚未实现.&lt;br/&gt;
并且上述代码着实很&amp;quot;丑陋&amp;quot;,在下一步的描述中会逐步重构.&lt;br/&gt;
但是作为一个简单的example,我想我应该展示了所有的东西.&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ruby的测试驱动开发实例</title>
   <link href="http://tom.preston-werner.com/2011/11/23/tdd.html"/>
   <updated>2011-11-23T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/11/23/tdd</id>
   <content type="html">&lt;hr/&gt;

&lt;h2&gt;ruby的测试驱动开发实例&lt;/h2&gt;

&lt;hr/&gt;

&lt;p&gt;Ruby被称为&amp;quot;敏捷&amp;quot;的语言,在开发中采用测试驱动会更加&lt;strong&gt;高效&lt;/strong&gt;并且充满&lt;strong&gt;乐趣&lt;/strong&gt;.&lt;/p&gt;

&lt;h4&gt;高效&lt;/h4&gt;

&lt;p&gt;刚接触Ruby时感觉它很难&amp;quot;控制&amp;quot;,并且可能是出于某种心理原因,总想在动态语言中找出自己熟悉的如C/C++等在语言、IDE方面相似的内容，&lt;br/&gt;
不然就会很&amp;quot;惶恐&amp;quot;。这之中最明显的不适应是没有用的顺手的调试工具。&lt;/p&gt;

&lt;p&gt;将&amp;quot;调试&amp;quot;和&amp;quot;测试&amp;quot;相提并论我不知道是否合适，我觉得TDD在RUBY上的&amp;quot;高效&amp;quot;就和我们平时使用VC、Eclipse等IDE的调试一样，&lt;br/&gt;
但更人性化、更可控、更易见易理解。&lt;/p&gt;

&lt;h4&gt;乐趣&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;每个模块的完成都有&amp;quot;分摊&amp;quot;的成就感，而这是1+1&amp;gt;2的……&lt;/li&gt;
&lt;li&gt;不管失败还是成功，或者是重构时粗心大意，我都知道程序还在我的控制之中&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;TDD之旅&lt;/h3&gt;

&lt;p&gt;下面就一个具体的小例子来开始我们的TDD之旅.&lt;/p&gt;

&lt;p&gt;这个例子要从服务器通过http的request得到类似下列的字符串：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;Linux 59
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;Windows 46
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;MacOS 53&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;其中每一行有两个元素：一个字符串和随机数字。返回到客户端是&amp;quot;Linux 59\nWindows 46\nMacOS 53\n&amp;quot;这样一个字符串。&lt;/p&gt;

&lt;p&gt;服务器端的实现很简单，我比较喜欢Node.js,但这不是本文重点，就只贴出其代码，有兴趣可以查看相关资料。&lt;br/&gt;
代码如下：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; http = require(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;http&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    http.createServer(&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;function&lt;/span&gt;(request, response) {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        response.writeHead(&lt;span style=&quot;color:#00D&quot;&gt;200&lt;/span&gt;, {&lt;span style=&quot;color:#606&quot;&gt;&lt;span style=&quot;color:#404&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#404&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;: &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;text/plain&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;});
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; arr = [&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Linux&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Windows&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;MacOS&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;];
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; outputString=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt;(&lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; i=&lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span style=&quot;color:#00D&quot;&gt;3&lt;/span&gt;;i++){ 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; numInput = &lt;span style=&quot;color:#00D&quot;&gt;100&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;var&lt;/span&gt; numOutput = &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;new&lt;/span&gt; Number(Math.random() * numInput).toFixed(&lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;            outputString +=arr[i]+&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;+numOutput+&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;        response.write(outputString);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;        response.end();
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;    }).listen(&lt;span style=&quot;color:#00D&quot;&gt;8080&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;    console.log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Random Number Generator Running...&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    console.log(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;http://localhost:8080&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;我们要做的是&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;从服务器读取出字符串&lt;/li&gt;
&lt;li&gt;将字符串按行读出，放入数组&lt;/li&gt;
&lt;li&gt;将每一行重新组合在一个hash表中，key值有:name,:num,:is_even.&lt;/li&gt;
&lt;li&gt;根据每行的那个随机数将其从大到小排列&lt;/li&gt;
&lt;li&gt;判断随机数是否是偶数&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;最终显示结果为（包括了排序和判断偶数）：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    [{:name=&amp;gt;&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Linux&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, :num=&amp;gt;&lt;span style=&quot;color:#00D&quot;&gt;59&lt;/span&gt;, :is_even=&amp;gt;&lt;span style=&quot;color:#069&quot;&gt;false&lt;/span&gt;}, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;     {:name=&amp;gt;&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;MacOS&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, :num=&amp;gt;&lt;span style=&quot;color:#00D&quot;&gt;53&lt;/span&gt;, :is_even=&amp;gt;&lt;span style=&quot;color:#069&quot;&gt;false&lt;/span&gt;},
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;     {:name=&amp;gt;&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Windows&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, :num=&amp;gt;&lt;span style=&quot;color:#00D&quot;&gt;46&lt;/span&gt;, :is_even=&amp;gt;&lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;}]
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;TDD的基本思想是在开发功能代码之前先编写测试代码.也即先思考如何测试,并编写测试代码,然后再思考实现这些测试的方法.&lt;br/&gt;
关于TDD的介绍网上很多,百度百科里介绍的也比较全面,而我们只看实践：&lt;br/&gt;
首先我们把我们要实现的东西给写出来：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;#/home/myhome/mytdd.rb&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;open-uri&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    url = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;http://localhost:8080&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    page = open(url).read
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    p sort_text page
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;以上代码前部分是向服务器http://localhost:8080发送请求并取得数据，&lt;br/&gt;
open-uri是一个可以发送http请求的库，其open函数表示打开response返回的值。&lt;br/&gt;
我们关注的重点是在 &lt;code&gt;sort_text&lt;/code&gt; 这个方法上。&lt;br/&gt;
很明显，我希望能够通过 &lt;code&gt;sort_text&lt;/code&gt;将充服务器读取出来的数据按照我们预想的用hash数组来排序并判断偶数。&lt;br/&gt;
但是下一步不是去实现这个函数，别忘了我们是“&lt;strong&gt;测试&lt;/strong&gt;驱动开发“。&lt;br/&gt;
先写下测试代码再说：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#777&quot;&gt;#/home/myhome/mytdd-tests.rb&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;test/unit&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;./mytdd&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;MytddTests&lt;/span&gt; &amp;lt; &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Test&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Unit&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;TestCase&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;test_sort_text&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;          assert_equal([{&lt;span style=&quot;color:#A60&quot;&gt;:name&lt;/span&gt;=&amp;gt;&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Linux&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;color:#A60&quot;&gt;:num&lt;/span&gt;=&amp;gt;&lt;span style=&quot;color:#00D&quot;&gt;50&lt;/span&gt;,&lt;span style=&quot;color:#A60&quot;&gt;:is_even&lt;/span&gt;=&amp;gt;&lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;},
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;                       {&lt;span style=&quot;color:#A60&quot;&gt;:name&lt;/span&gt;=&amp;gt;&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Windows&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:num&lt;/span&gt;=&amp;gt;&lt;span style=&quot;color:#00D&quot;&gt;20&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:is_even&lt;/span&gt;=&amp;gt;&lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;}],
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;                       sort_text(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Windows 20&lt;/span&gt;&lt;span style=&quot;color:#b0b&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Linux 50&lt;/span&gt;&lt;span style=&quot;color:#b0b&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;))
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;然后运行 &lt;code&gt;ruby mytdd-tests.rb&lt;/code&gt;,得到如下提示：&lt;br/&gt;
    in &lt;code&gt;&amp;lt;top (required)&amp;gt;&amp;#39;: undefined method&lt;/code&gt;sort&lt;em&gt;text&amp;#39; for main:Object (NoMethodError)&lt;br/&gt;
        from &amp;lt;internal:lib/rubygems/custom&lt;/em&gt;require&amp;gt;:29:in &lt;code&gt;require&amp;#39;&lt;br/&gt;
        from &amp;lt;internal:lib/rubygems/custom_require&amp;gt;:29:in&lt;/code&gt;require&amp;#39;&lt;br/&gt;
        from mytdd-test.rb:2:in `&lt;main&gt;&amp;#39;&lt;br/&gt;
这个错误是必然的，我们还没有实现sort_text自然无法找到这个方法了。&lt;br/&gt;
虽然这个流程貌似没有多少&amp;quot;实际&amp;quot;意义,但这正是TDD精义的体现.ruby在web上有一个很优美的框架叫Rails,&lt;br/&gt;
我感觉这个名字能够很好地解释TDD(尽管Rails并不是TDD的专属).简而言之,TDD为编程铺设了&amp;quot;&lt;strong&gt;轨道&lt;/strong&gt;&amp;quot;,&lt;br/&gt;
我们的程序就是运行在这个轨道上的列车.虽然偶尔会发生&amp;quot;不管你信不信反正我是信了&amp;quot;的奇迹,&lt;br/&gt;
但这个轨道确实能让我们对程序的运行路线有很强的控制.&lt;/p&gt;

&lt;p&gt;我们先让测试通过再说,它不是提示没有这个函数吗?没关系,我们在mytdd.rb中定义一个:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;sort_text&lt;/span&gt; text
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;等等,怎么什么都没做?!&lt;/p&gt;

&lt;p&gt;不是,我们起码让测试可以运行了:&lt;br/&gt;
    nil&lt;br/&gt;
    Loaded suite mytdd-test&lt;br/&gt;
    Started&lt;br/&gt;
    F&lt;br/&gt;
    Finished in 0.001084 seconds.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    1) Failure:
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;test_sort_text(MytddTests) [v2-test.rb:7]:
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;&amp;lt;[{:name=&amp;gt;&amp;quot;Linux&amp;quot;, :num=&amp;gt;50, :is_even=&amp;gt;true},
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt; {:name=&amp;gt;&amp;quot;Windows&amp;quot;, :num=&amp;gt;20, :is_even=&amp;gt;true}]&amp;gt; expected but was
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;&amp;lt;nil&amp;gt;.
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;1 tests, 1 assertions, 1 failures, 0 errors, 0 skips
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;Test run options: --seed 53447&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;注意:测试失败和测试运行错误是两回事!!!&lt;br/&gt;
测试失败表示我们写的功能出错,测试运行错误则是代码有语法错误.&lt;/p&gt;

&lt;p&gt;这个测试Failure提示我们:测试期望的结果是一个带hash的数组,而我们实际得到的却是一个nil值.&lt;/p&gt;

&lt;p&gt;这样的结果很容易理解,因为我们在mytdd.rb中定义的sort&lt;em&gt;text方法根本什么都没做,自然返回的是nil值.&lt;br/&gt;
下边重要到实现阶段了.我希望通过三个函数来实现读取数组、构建hash和排序,所以在sort&lt;/em&gt;text中我使用了三个方法:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;sort_text&lt;/span&gt; text
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        arr=read_in_arr text
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        arr_hash=read_in_hash arr
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        result=sort_arr_hash arr_hash
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;然后就是测试，重复上边的步骤：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;构建测试代码和数据&lt;/li&gt;
&lt;li&gt;运行测试，有错误，提示找不到方法&lt;/li&gt;
&lt;li&gt;作出三个没有具体实现的方法&lt;/li&gt;
&lt;li&gt;运行测试，无错误，但提示测试用例失败&lt;/li&gt;
&lt;li&gt;实现这三个方法&lt;/li&gt;
&lt;li&gt;再运行测试&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;整个过程的&lt;a href=&quot;/file/mytdd.tar.gz&quot;&gt;源代码&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;但这并不是TDD的全部。TDD还有一个重要的环节：重构Refactor。&lt;/p&gt;

&lt;h4&gt;重构Refactor&lt;/h4&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>spatialite c samples 解析（3）</title>
   <link href="http://tom.preston-werner.com/2011/11/16/spatialitecsample3.html"/>
   <updated>2011-11-16T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/11/16/spatialitecsample3</id>
   <content type="html">&lt;hr/&gt;

&lt;h2&gt;spatialite c samples 解析（3）&lt;/h2&gt;

&lt;hr/&gt;

&lt;h3&gt;1.创建空间数据库&lt;/h3&gt;

&lt;p&gt;创建数据库和打开数据库使用同样的函数,只不过将参数改为可读写且能够创建(即不存在时可以重新创建一个数据库文件):&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    ret = sqlite3_open_v2 (argv[&lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt;], &amp;amp;handle,SQLITE_OPEN_READWRITE | SQLITE_OPEN_CREATE, &lt;span style=&quot;color:#069&quot;&gt;NULL&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;1.1初始化空间要素&lt;/h4&gt;

&lt;p&gt;spatialite提供一种初始化空间元数据的方法,执行下列语句即可:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; InitSpatialMetadata();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;通过该方法创建的数据库表如下:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/spatialite/inittree.png&quot; alt=&quot;树状结构表&quot;/&gt;&lt;/p&gt;

&lt;p&gt;其执行的函数可以通过master中的内容看出:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/spatialite/initmaster.png&quot; alt=&quot;master图&quot;/&gt;&lt;/p&gt;

&lt;p&gt;上图表示执行&amp;quot;SELECT InitSpatialMetadata();&amp;quot;后所进行的操作包括:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;创建spatial&lt;em&gt;ref&lt;/em&gt;sys表及其触发(trigger)规则;&lt;/li&gt;
&lt;li&gt;创建geometry_columns表及其触发规则,并为之创建索引;&lt;/li&gt;
&lt;li&gt;创建geom&lt;em&gt;cols&lt;/em&gt;ref_sys视图.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;解释下触发(trigger)的含义及其在空间数据库中的作用.&lt;/p&gt;

&lt;p&gt;触发即在执行数据库操作时需要执行的规则,这个规则可以是在执行前或后.&lt;/p&gt;

&lt;p&gt;在此处的作用我们以具体的例子来说明:&lt;/p&gt;

&lt;p&gt;本例中总共创建了三个触发规则:fkd&lt;em&gt;refsys&lt;/em&gt;geocols,fki&lt;em&gt;geocols&lt;/em&gt;refsys,fku&lt;em&gt;geocols&lt;/em&gt;refsys.&lt;br/&gt;
触发名称的第三个字母分别表示:delete,insert和update,也就是说这三个触发是在执行删除、插入、更新时所触发的.&lt;br/&gt;
我们以fki&lt;em&gt;geocols&lt;/em&gt;refsys为例看看究竟是什么规则:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;CREATE&lt;/span&gt; &lt;span style=&quot;color:#339;font-weight:bold&quot;&gt;TRIGGER&lt;/span&gt; fki_geocols_refsys &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;BEFORE&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;INSERT&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;ON&lt;/span&gt; geometry_columns
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;FOR&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;EACH&lt;/span&gt; &lt;span style=&quot;color:#339;font-weight:bold&quot;&gt;ROW&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;BEGIN&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; RAISE(&lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;ROLLBACK&lt;/span&gt;, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;insert on table ''geometry_columns'' violates constraint: ''spatial_ref_sys.srid''&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;WHERE&lt;/span&gt;  NEW.&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;srid&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;IS&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;NOT&lt;/span&gt; &lt;span style=&quot;color:#069&quot;&gt;NULL&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;AND&lt;/span&gt; (&lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; srid &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;FROM&lt;/span&gt; spatial_ref_sys &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;WHERE&lt;/span&gt; srid = NEW.srid) &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;IS&lt;/span&gt; &lt;span style=&quot;color:#069&quot;&gt;NULL&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;END&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;很明显,这个触发器的意思是在向geometry&lt;em&gt;columns插入数据之前,如果新插入的数据中srid不是空,&lt;br/&gt;
并且spatial&lt;/em&gt;ref_sys表中不存在新插入数据的srid值,那么就抛出错误终止查询操作.&lt;/p&gt;

&lt;p&gt;通俗地讲,也就是说你向geometry&lt;em&gt;columns插入的srid值不是随便一个值,它必须是spatial&lt;/em&gt;ref&lt;em&gt;sys中的一个.&lt;br/&gt;
或者可以理解为geometry&lt;/em&gt;columns表对spatial&lt;em&gt;ref&lt;/em&gt;sys有依赖.&lt;/p&gt;

&lt;p&gt;关于初始化及触发的更多具体详细的细节请参考spatialite的教程文档.&lt;/p&gt;

&lt;h4&gt;1.2插入基本的数据项,并创建空间数据表.&lt;/h4&gt;

&lt;p&gt;在上一步创建的数据表spatial&lt;em&gt;ref&lt;/em&gt;sys是空间数据所必需依赖的,我们要为之插入一个初始值.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;INSERT&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;INTO&lt;/span&gt; spatial_ref_sys 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        (srid, auth_name, auth_srid, ref_sys_name, proj4text)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;VALUES&lt;/span&gt; (&lt;span style=&quot;color:#00D&quot;&gt;3003&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;epsg&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;3003&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;Monte Mario / Italy zone 1&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;+proj=tmerc +lat_0=0 +lon_0=9 +k=0.9996 +x_0=1500000 +y_0=0 +ellps=intl +units=m +no_defs&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;然后创建一个存放空间数据的数据表test:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;CREATE&lt;/span&gt; &lt;span style=&quot;color:#339;font-weight:bold&quot;&gt;TABLE&lt;/span&gt; test (PK &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;INTEGER&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;NOT&lt;/span&gt; &lt;span style=&quot;color:#069&quot;&gt;NULL&lt;/span&gt; &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;PRIMARY&lt;/span&gt; &lt;span style=&quot;color:#339;font-weight:bold&quot;&gt;KEY&lt;/span&gt;,name &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;VARCHAR&lt;/span&gt;(&lt;span style=&quot;color:#00D&quot;&gt;6&lt;/span&gt;))
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;spatialite提供创建空间数据项的的方法AddGeometryColumn();我们创建一个点要素:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; AddGeometryColumn(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;geom&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;3003&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;POINT&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;2&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;此方法只是创建了两个触发规则:ggi&lt;em&gt;test&lt;/em&gt;geom,ggu&lt;em&gt;test&lt;/em&gt;geom,不再细述.&lt;br/&gt;
插入数据&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;INSERT&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;INTO&lt;/span&gt; test(name,geom) &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;VALUES&lt;/span&gt; (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;郑州&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;,GeomFromText(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;POINT(117 34)&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;,&lt;span style=&quot;color:#00D&quot;&gt;4326&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;2.空间索引&lt;/h3&gt;

&lt;h4&gt;2.1创建空间索引:&lt;/h4&gt;

&lt;p&gt;spatialite提供两种索引方法:R-Tree和MbrCache.&lt;/p&gt;

&lt;p&gt;R-Tree:与我们平常所说的四叉树类似,但是对索引方法进行优化以适用空间数据的复杂性.具体表现在:1.尽可能包含多的目标,2.尽可能让矩形间少重叠.&lt;/p&gt;

&lt;p&gt;Mbrcache实际上并不是索引,只是将数据存储在内存中,加快了读取速度.&lt;/p&gt;

&lt;h5&gt;2.1.1R-Tree空间索引:&lt;/h5&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; CreateSpatialIndex(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;geom&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;该方法在master中的操作如下图所述,与上文所讲方法类似:&lt;br/&gt;
&lt;img src=&quot;/images/spatialite/index.png&quot; alt=&quot;空间索引&quot;/&gt;&lt;br/&gt;
#####2.1.2MbrCache索引&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; CreateMbrCache(&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;geom&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;该方法在master中的操作如下图所述,与上文所讲方法类似:&lt;br/&gt;
&lt;img src=&quot;/images/spatialite/mbrcache.png&quot; alt=&quot;mbrcache&quot;/&gt;&lt;/p&gt;

&lt;h4&gt;2.2空间查询&lt;/h4&gt;

&lt;p&gt;空间索引只有在超大数据容量时才能显现其作用,我们先向其中插入&lt;strong&gt;100万&lt;/strong&gt;个点数据.&lt;br/&gt;
在不同的空间索引下插入的速度和数据库大小也是不同的:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;没有构建索引直接插入: 34秒,70.5M&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;R-Tree索引:        136秒,120.3M&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;MbrCache索引:      47秒,70.5M&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;从数据库的大小就可以看出:R-Tree在数据库中&lt;strong&gt;添加&lt;/strong&gt;了一些东西,从上图可以看出,&lt;br/&gt;
Rtree添加了四个索引表idx_,而多出的50M容量就是建立的空间索引所占的容量.&lt;br/&gt;
相比之下,MbrCache的内容就基本上和没有索引一样.&lt;/p&gt;

&lt;p&gt;至于&lt;strong&gt;查询速度&lt;/strong&gt;,在有空间索引(无论R-Tree还是MbrCache)的情况下基本是0秒,&lt;br/&gt;
无索引则多达27秒.&lt;/p&gt;

&lt;h5&gt;普通的查询方法:&lt;/h5&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;Count&lt;/span&gt;(*) &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;FROM&lt;/span&gt; test 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;WHERE&lt;/span&gt; MbrWithin(geom, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;            BuildMbr(&lt;span style=&quot;color:#60E&quot;&gt;1000400.5&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;4000400.5&lt;/span&gt;,&lt;span style=&quot;color:#60E&quot;&gt;1000450.5&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;4000450.5&lt;/span&gt;))
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h5&gt;R-Tree索引法:&lt;/h5&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;Count&lt;/span&gt;(*) &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;FROM&lt;/span&gt; test 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;WHERE&lt;/span&gt; MbrWithin(geom, BuildMbr(&lt;span style=&quot;color:#60E&quot;&gt;1000400.5&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;4000400.5&lt;/span&gt;,&lt;span style=&quot;color:#60E&quot;&gt;1000450.5&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;4000450.5&lt;/span&gt;))
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;AND&lt;/span&gt; ROWID &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;IN&lt;/span&gt; ( &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; pkid &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;FROM&lt;/span&gt; idx_test_geom 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;                                        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;WHERE&lt;/span&gt;  xmin &amp;gt; &lt;span style=&quot;color:#60E&quot;&gt;1000400.5&lt;/span&gt; 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;                                        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;AND&lt;/span&gt; xmax &amp;lt; &lt;span style=&quot;color:#60E&quot;&gt;1000450.5&lt;/span&gt; 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;                                        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;AND&lt;/span&gt; ymin &amp;gt; &lt;span style=&quot;color:#60E&quot;&gt;4000400.5&lt;/span&gt; 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;                                        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;AND&lt;/span&gt; ymax &amp;lt; &lt;span style=&quot;color:#60E&quot;&gt;4000450.5&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h5&gt;MbrCache法:&lt;/h5&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; &lt;span style=&quot;color:#369;font-weight:bold&quot;&gt;Count&lt;/span&gt;(*) &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;FROM&lt;/span&gt; test 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;WHERE&lt;/span&gt; ROWID &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;IN&lt;/span&gt; (&lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;SELECT&lt;/span&gt; rowid &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;FROM&lt;/span&gt; cache_test_geom 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;WHERE&lt;/span&gt; mbr = FilterMbrWithin(&lt;span style=&quot;color:#60E&quot;&gt;1000400.5&lt;/span&gt;,&lt;span style=&quot;color:#60E&quot;&gt;4000400.5&lt;/span&gt;,&lt;span style=&quot;color:#60E&quot;&gt;1000450.5&lt;/span&gt;,&lt;span style=&quot;color:#60E&quot;&gt;4000450.5&lt;/span&gt;))
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>spatialite c samples 解析（2）</title>
   <link href="http://tom.preston-werner.com/2011/11/04/spatialitecsample2.html"/>
   <updated>2011-11-04T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/11/04/spatialitecsample2</id>
   <content type="html">&lt;hr/&gt;

&lt;h2&gt;spatialite c samples 解析（2）&lt;/h2&gt;

&lt;hr/&gt;

&lt;h3&gt;1.在程序中使用spatialite数据类型。&lt;/h3&gt;

&lt;p&gt;gaiaAllocGeomColl函数可以分配一个空间数据类型.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    gaiaGeomCollPtr geo;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    geo=gaiaAllocGeomColl();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;然后再将空间数据写入到该变量中,通过执行下边函数即可:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    gaiaAddPointToGeomColl (geo, &lt;span style=&quot;color:#60E&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.5&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.75&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;当然也有gaiaAddLinestringToGeomColl,gaiaAddPolygonToGeomColl来分别对应点,线,面.&lt;br/&gt;
所不同的是线和面的分配方法稍微复杂些,函数的定义如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;void&lt;/span&gt; gaiaAddPointToGeomColl( gaiaGeomCollPtr p , &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; x , &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; y );
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    gaiaLinestringPtr gaiaAddLinestringToGeomColl ( gaiaGeomCollPtr p , &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; points);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    gaiaPolygonPtr gaiaAddPolygonToGeomColl (gaiaGeomCollPtr p, &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; points, &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; num_interiors);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;后两者都有对应该类型的返回值.&lt;br/&gt;
所以线的操做如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    gaiaLinestringPtr line;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    line = gaiaAddLinestringToGeomColl (geo_ln, &lt;span style=&quot;color:#00D&quot;&gt;5&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    gaiaSetPoint (line-&amp;gt;Coords, &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    gaiaSetPoint (line-&amp;gt;Coords, &lt;span style=&quot;color:#00D&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    gaiaSetPoint (line-&amp;gt;Coords, &lt;span style=&quot;color:#00D&quot;&gt;2&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    gaiaSetPoint (line-&amp;gt;Coords, &lt;span style=&quot;color:#00D&quot;&gt;3&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;10&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;, &lt;span style=&quot;color:#60E&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    gaiaSetPoint (line-&amp;gt;Coords, &lt;span style=&quot;color:#00D&quot;&gt;4&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;10&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;, &lt;span style=&quot;color:#00D&quot;&gt;10&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color:#60E&quot;&gt;.0&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;需要注意的是line,它是geo&lt;em&gt;ln的一个成员,可以指向geo&lt;/em&gt;ln,从gaiaGeomCollPtr的定义可以看出:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;typedef&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;struct&lt;/span&gt; gaiaGeomCollStruct {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; Srid;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        gaiaPointPtr FirstPoint;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        gaiaLinestringPtr FirstLinestring;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;        gaiaPolygonPtr FirstPolygon;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MinX;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MinY;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MaxX;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MaxY;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    }gaiaGeomColl;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;typedef&lt;/span&gt; gaiaGeomColl * gaiaGeomCollPtr;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;真正的数据是存储在 FirstLinestring所指向的内存空间.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;typedef&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;struct&lt;/span&gt; gaiaLinestringStruct {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; Points;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; * Coords;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MinX;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MinY;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MaxX;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MaxY;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;struct&lt;/span&gt; gaiaLinestringStruct * Next;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;    }gaiaLinestring;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;typedef&lt;/span&gt; gaiaLinestring * gaiaLinestringPtr;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;面的操作与之类似.&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>spatialite c samples 解析（1）</title>
   <link href="http://tom.preston-werner.com/2011/10/29/spatialitecsample.html"/>
   <updated>2011-10-29T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/10/29/spatialitecsample</id>
   <content type="html">&lt;hr/&gt;

&lt;h2&gt;&lt;strong&gt;spatialite c samples 解析（1）&lt;/strong&gt;&lt;/h2&gt;

&lt;hr/&gt;

&lt;h4&gt;0.初始化spatialite扩展&lt;/h4&gt;

&lt;p&gt;由于spatialite是基于sqlite的扩展，所以在使用sqlite查询之前要先将sqatilate初始化。&lt;br/&gt;
代码如下&lt;br/&gt;
    spatialite_init(0);&lt;/p&gt;

&lt;h4&gt;1.连接数据库&lt;/h4&gt;

&lt;p&gt;sqlite提供的连接数据库方法有三个：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; sqlite3_open(
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;char&lt;/span&gt; *filename,   &lt;span style=&quot;color:#777&quot;&gt;/* Database filename (UTF-8) */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        sqlite3 **ppDb          &lt;span style=&quot;color:#777&quot;&gt;/* OUT: SQLite db handle */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    );
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; sqlite3_open16(
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;void&lt;/span&gt; *filename,   &lt;span style=&quot;color:#777&quot;&gt;/* Database filename (UTF-16) */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        sqlite3 **ppDb          &lt;span style=&quot;color:#777&quot;&gt;/* OUT: SQLite db handle */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    );
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; sqlite3_open_v2(
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;      &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;char&lt;/span&gt; *filename,   &lt;span style=&quot;color:#777&quot;&gt;/* Database filename (UTF-8) */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;      sqlite3 **ppDb,         &lt;span style=&quot;color:#777&quot;&gt;/* OUT: SQLite db handle */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; flags,              &lt;span style=&quot;color:#777&quot;&gt;/* Flags */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;char&lt;/span&gt; *zVfs        &lt;span style=&quot;color:#777&quot;&gt;/* Name of VFS module to use */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;    );
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;数据库连接被放在在 *ppDb内，其他的查询操作可以通过它来找到所连接数据库。如果连接成功那么函数返回SQLITE&lt;em&gt;OK;如果出现错误，&lt;br/&gt;
可以使用sqlite3&lt;/em&gt;errmsg() 或者 sqlite3&lt;em&gt;errmsg16()来获取错误的英文说明。需要注意的是，&lt;br/&gt;
不管是否连接成功，当不再需要数据库连接时，与连接数据库操作的资源都应该通过sqlite3&lt;/em&gt;close()来释放。&lt;/p&gt;

&lt;p&gt;其中 sqlite3&lt;em&gt;open&lt;/em&gt;v2比另外两个多出的两个参数可以对所建立的连接进行额外的操作。&lt;br/&gt;
例如flags可以取SQLITE&lt;em&gt;OPEN&lt;/em&gt;READONLY,SQLITE&lt;em&gt;OPEN&lt;/em&gt;READWRITE,SQLITE&lt;em&gt;OPEN&lt;/em&gt;READWRITE|SQLITE&lt;em&gt;OPEN&lt;/em&gt;CREATE 三个值，并且可以和SQLITE&lt;em&gt;OPEN&lt;/em&gt;NOMUTEX,&lt;br/&gt;
 SQLITE&lt;em&gt;OPEN&lt;/em&gt;FULLMUTEX, SQLITE&lt;em&gt;OPEN&lt;/em&gt;SHAREDCACHE, SQLITE&lt;em&gt;OPEN&lt;/em&gt;PRIVATECACHE, &lt;br/&gt;
 SQLITE&lt;em&gt;OPEN&lt;/em&gt;URI 共同使用（通过或、交（|,&amp;amp;)运算来操作）；zVfs是与操作系统的接口，取NULL则为程序默认。&lt;/p&gt;

&lt;h4&gt;2.数据库查询&lt;/h4&gt;

&lt;p&gt;此处以&lt;code&gt;sqlite3_prepare_v2&lt;/code&gt;为例：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; sqlite3_prepare_v2(
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;      sqlite3 *db,            &lt;span style=&quot;color:#777&quot;&gt;/* Database handle */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;char&lt;/span&gt; *zSql,       &lt;span style=&quot;color:#777&quot;&gt;/* SQL statement, UTF-8 encoded */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; nByte,              &lt;span style=&quot;color:#777&quot;&gt;/* Maximum length of zSql in bytes. */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;      sqlite3_stmt **ppStmt,  &lt;span style=&quot;color:#777&quot;&gt;/* OUT: Statement handle */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;char&lt;/span&gt; **pzTail     &lt;span style=&quot;color:#777&quot;&gt;/* OUT: Pointer to unused portion of zSql */&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;  );
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;其中 &lt;em&gt;db即为上一步获取的&lt;/em&gt;ppDb，zSql是将要编译的SQL查询语句，**ppStmt为操作处理。&lt;/p&gt;

&lt;p&gt;当执行prepare后，需要执行一次或多次 &lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; sqlite_step(sqlite2_stmt*);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;来读取数据。&lt;br/&gt;
通过执行&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; sqlite3_column_count(sqlite3_stmt *pStmt);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;可以查出总共查询到数据表的列数。&lt;/p&gt;

&lt;p&gt;然后再执行spatialite中针对空间数据BLOB的方法来操作BLOB中的数据，下文再详细解释，先看代码：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    sqlite3 *handle;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    sqlite3_stmt *stmt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    spatialite_init(&lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    ret = sqlite3_open_v2(path,&amp;amp;handle,SQLITE_OPEN_READONLY,&lt;span style=&quot;color:#069&quot;&gt;NULL&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt;(ret != SQLITE_OK)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    { &lt;span style=&quot;color:#777&quot;&gt;//ERROR HERE }&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    sql = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;SELECT * FROM mytable&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    ret = sqlite2_prepare_v2(handle,sql,strlen(sql),&amp;amp;stmt,&lt;span style=&quot;color:#069&quot;&gt;NULL&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt;(ret != SQLITE_OK)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    { &lt;span style=&quot;color:#777&quot;&gt;//ERROR HERE }&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    n_columns = sqlite3_column_count(stmt);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;while&lt;/span&gt;(&lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;    {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;        ret = sqlite3_step (stmt);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; (ret == SQLITE_DONE)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;break&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; (ret == SQLITE_ROW)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;        {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;            row_no++;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;            printf (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;row #%d&lt;/span&gt;&lt;span style=&quot;color:#b0b&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, row_no);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;for&lt;/span&gt; (ic = &lt;span style=&quot;color:#00D&quot;&gt;0&lt;/span&gt;; ic &amp;lt; n_columns; ic++)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;        {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;            printf (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#b0b&quot;&gt;\t&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;%-10s = &lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;,sqlite3_column_name (stmt, ic));
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;switch&lt;/span&gt; (sqlite3_column_type (stmt, ic))
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;            {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;                &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;case&lt;/span&gt; SQLITE_INTEGER:
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;                printf (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, sqlite3_column_int (stmt, ic));
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;                    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;break&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;case&lt;/span&gt; SQLITE_BLOB:
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;                    blob = sqlite3_column_blob (stmt, ic);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;                    blob_size = sqlite3_column_bytes (stmt, ic);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n33&quot; name=&quot;n33&quot;&gt;33&lt;/a&gt;&lt;/span&gt;                    geom = gaiaFromSpatiaLiteBlobWkb (blob,blob_size);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n34&quot; name=&quot;n34&quot;&gt;34&lt;/a&gt;&lt;/span&gt;                    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; (!geom)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n35&quot; name=&quot;n35&quot;&gt;35&lt;/a&gt;&lt;/span&gt;                        printf (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;BLOB [%d bytes]&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, blob_size);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n36&quot; name=&quot;n36&quot;&gt;36&lt;/a&gt;&lt;/span&gt;                    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n37&quot; name=&quot;n37&quot;&gt;37&lt;/a&gt;&lt;/span&gt;                    {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n38&quot; name=&quot;n38&quot;&gt;38&lt;/a&gt;&lt;/span&gt;                        geom_type = gaiaGeometryType (geom);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n39&quot; name=&quot;n39&quot;&gt;39&lt;/a&gt;&lt;/span&gt;                        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; (geom_type == GAIA_UNKNOWN)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n40&quot; name=&quot;n40&quot;&gt;40&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                            printf (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;EMPTY or NULL GEOMETRY&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n41&quot; name=&quot;n41&quot;&gt;41&lt;/a&gt;&lt;/span&gt;                        &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n42&quot; name=&quot;n42&quot;&gt;42&lt;/a&gt;&lt;/span&gt;                        {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n43&quot; name=&quot;n43&quot;&gt;43&lt;/a&gt;&lt;/span&gt;                            &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;char&lt;/span&gt; *geom_name;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n44&quot; name=&quot;n44&quot;&gt;44&lt;/a&gt;&lt;/span&gt;                            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; (geom_type == GAIA_POINT)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n45&quot; name=&quot;n45&quot;&gt;45&lt;/a&gt;&lt;/span&gt;                                geom_name = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;POINT&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;;               
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n46&quot; name=&quot;n46&quot;&gt;46&lt;/a&gt;&lt;/span&gt;                            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; (geom_type == GAIA_POLYGON)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n47&quot; name=&quot;n47&quot;&gt;47&lt;/a&gt;&lt;/span&gt;                                geom_name = &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;POLYGON&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n48&quot; name=&quot;n48&quot;&gt;48&lt;/a&gt;&lt;/span&gt;                            printf (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;%s SRID=%d&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, geom_name,geom-&amp;gt;Srid);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n49&quot; name=&quot;n49&quot;&gt;49&lt;/a&gt;&lt;/span&gt;                            &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;if&lt;/span&gt; (geom_type == GAIA_POLYGON ||geom_type ==GAIA_MULTIPOLYGON)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n50&quot; name=&quot;n50&quot;&gt;50&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;                            {
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n51&quot; name=&quot;n51&quot;&gt;51&lt;/a&gt;&lt;/span&gt;                                gaiaGeomCollArea (geom, &amp;amp;measure);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n52&quot; name=&quot;n52&quot;&gt;52&lt;/a&gt;&lt;/span&gt;                                printf (&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt; area=%1.2lf&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, measure);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n53&quot; name=&quot;n53&quot;&gt;53&lt;/a&gt;&lt;/span&gt;                            }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n54&quot; name=&quot;n54&quot;&gt;54&lt;/a&gt;&lt;/span&gt;                        }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n55&quot; name=&quot;n55&quot;&gt;55&lt;/a&gt;&lt;/span&gt;                        gaiaFreeGeomColl (geom);
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n56&quot; name=&quot;n56&quot;&gt;56&lt;/a&gt;&lt;/span&gt;                    }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n57&quot; name=&quot;n57&quot;&gt;57&lt;/a&gt;&lt;/span&gt;                    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;break&lt;/span&gt;;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n58&quot; name=&quot;n58&quot;&gt;58&lt;/a&gt;&lt;/span&gt;                }
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n59&quot; name=&quot;n59&quot;&gt;59&lt;/a&gt;&lt;/span&gt;    }
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;以上代码在列属性上只列出了两个case:Integer和BLOB，Geometry类型也只列出Point和Polygon，&lt;br/&gt;
更具体的参见&lt;a href=&quot;http://www.sqlite.org/c3ref/funclist.html&quot;&gt;sqlite c API&lt;/a&gt;和&lt;br/&gt;
&lt;a href=&quot;http://www.gaia-gis.it/spatialite/spatialite-C-API-2.3.1.html&quot;&gt;spatialite c API&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;此处解释上边代码中遇到的几个spatialite函数。&lt;br/&gt;
首先就是读取出BLOB数据：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;const&lt;/span&gt; &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;void&lt;/span&gt; * blob;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    blob = sqlite3_column_blob (stmt, ic);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;然后通过spatialite的方法读取为空间处理数据（以gaia开头的函数都是spatialite的方法，而以sqlite开通的为sqlite的方法，spatialite是sqlite的扩展即体现在此处)。&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    gaiaGeomCollPtr geom;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    geom = gaiaFromSpatiaLiteBlobWkb (blob,blob_size);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;gaiaGeomCollPtr的定义如下：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;typedef&lt;/span&gt; &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;struct&lt;/span&gt; gaiaGeomCollStruct {
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;int&lt;/span&gt; Srid;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        gaiaPointPtr FirstPoint;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        gaiaLinestringPtr FirstLinestring;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;        gaiaPolygonPtr FirstPolygon;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MinX;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MinY;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MaxX;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;        &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; MaxY;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    } gaiaGeomColl;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;typedef&lt;/span&gt; gaiaGeomColl * gaiaGeomCollPtr;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;可见，gaiaGeomCollPtr 是指针形式，且其数据项包括该地理数据的MBR(Minimum Bounding Rectangle 最小外接矩形)。&lt;/p&gt;

&lt;p&gt;gaiaFromSpatiaLiteBlobWkb函数的第一个参数是&lt;code&gt;const unsigned char * blob_wkb&lt;/code&gt;,而WKB(Well Known Binary)&lt;br/&gt;
即为我们从数据库中读取的BLOB格式的数据。也就是说sqlite是将空间数据转换成WKB后存储。&lt;/p&gt;

&lt;p&gt;代码后边的&lt;code&gt;gaiaGeometryType gaiaGeomCollArea&lt;/code&gt;等方法在此不赘述，详见&lt;br/&gt;
&lt;a href=&quot;http://www.gaia-gis.it/spatialite/spatialite-C-API-2.3.1.html&quot;&gt;spatialite c API&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>SpatialiteGIS源代码解读</title>
   <link href="http://tom.preston-werner.com/2011/10/29/spatailitegis.html"/>
   <updated>2011-10-29T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/10/29/spatailitegis</id>
   <content type="html">&lt;p&gt;###Classdef.h&lt;/p&gt;

&lt;p&gt;定义了整个工程所需的类,总共65个:&lt;/p&gt;

&lt;p&gt;MyVariant:存储多样数据的类&lt;/p&gt;

&lt;p&gt;MyRowVariant:&lt;/p&gt;

&lt;p&gt;MyVariantList:存储索引的结果集&lt;/p&gt;

&lt;p&gt;MyBlobs:&lt;/p&gt;

&lt;p&gt;MyValues:存储待编辑的列的数值&lt;/p&gt;

&lt;p&gt;QueryColumn:地理数据表存储&lt;/p&gt;

&lt;p&gt;QueryTable:地理数据表列表&lt;/p&gt;

&lt;p&gt;IdentifyEntity:存储GIS实体&lt;/p&gt;

&lt;p&gt;IdentifyEntitiesList:在显示属性时显示GIS实体列表&lt;/p&gt;

&lt;p&gt;MyDistinctValue:存储没有重复的值&lt;/p&gt;

&lt;p&gt;MyDistinctValueList:&lt;/p&gt;

&lt;p&gt;MyRangeValue:&lt;/p&gt;

&lt;p&gt;MyRangeValueList&lt;/p&gt;

&lt;p&gt;MyBitmap:用于符号和画刷的图形&lt;/p&gt;

&lt;p&gt;MyImageList:&lt;/p&gt;

&lt;p&gt;SridInfo:srid信息&lt;/p&gt;

&lt;p&gt;MyLayer:图层,矢量、栅格等&lt;/p&gt;

&lt;p&gt;MyLayerList:&lt;/p&gt;

&lt;p&gt;MyLayerSubClass:&lt;/p&gt;

&lt;p&gt;MyLayerParams&lt;/p&gt;

&lt;p&gt;MyLayerParamsList&lt;/p&gt;

&lt;p&gt;LayerObject:继承自wxTreeItemData&lt;/p&gt;

&lt;p&gt;SubClassesContainer:包含一个LayerObject指针的数组&lt;/p&gt;

&lt;p&gt;MyLayerTree:继承自wxTreeCtrl&lt;/p&gt;

&lt;p&gt;MapSubClass:&lt;/p&gt;

&lt;p&gt;MapLayer&lt;/p&gt;

&lt;p&gt;MapLayersList&lt;/p&gt;

&lt;p&gt;MyTipWindow:继承自wxWindow&lt;/p&gt;

&lt;p&gt;MarkerGraphicResource:标记&lt;/p&gt;

&lt;p&gt;GeometryToMark:&lt;/p&gt;

&lt;p&gt;GeometriesToMark:&lt;/p&gt;

&lt;p&gt;MyMapView:继承自wxPanel&lt;/p&gt;

&lt;p&gt;MyFrame:继承自wxFrame&lt;/p&gt;

&lt;p&gt;SearchSridDialog:&lt;/p&gt;

&lt;p&gt;DefaultCharsetDialog&lt;/p&gt;

&lt;p&gt;ProjectCrsDialog&lt;/p&gt;

&lt;p&gt;VectorCrsDialog&lt;/p&gt;

&lt;p&gt;RasterCrsDialog&lt;/p&gt;

&lt;p&gt;VisibilityRangeDialog&lt;/p&gt;

&lt;p&gt;PointGraphicsDialog&lt;/p&gt;

&lt;p&gt;LineGraphicsDialog&lt;/p&gt;

&lt;p&gt;PolygonGraphicsDialog&lt;/p&gt;

&lt;p&gt;LoadShpDialog&lt;/p&gt;

&lt;p&gt;DumpShpDialog&lt;/p&gt;

&lt;p&gt;SubClassObject:继承自wxTreeItemData&lt;/p&gt;

&lt;p&gt;SubClassesPreview:继承自wxTreeCtl&lt;/p&gt;

&lt;p&gt;SubClassSymbolTypeDialog&lt;/p&gt;

&lt;p&gt;SubClassSizeDialog&lt;/p&gt;

&lt;p&gt;SubClassRangeDialog&lt;/p&gt;

&lt;p&gt;SubClassColorDialog&lt;/p&gt;

&lt;p&gt;PointLayerClassifyDialog&lt;/p&gt;

&lt;p&gt;LineLayerClassifyDialog&lt;/p&gt;

&lt;p&gt;PolygonLayerClassifyDialog&lt;/p&gt;

&lt;p&gt;TableColumn:创建数据表及数据表(图层)布局&lt;/p&gt;

&lt;p&gt;TableLayout:&lt;/p&gt;

&lt;p&gt;CreateTableDialog&lt;/p&gt;

&lt;p&gt;TableLayoutDialog&lt;/p&gt;

&lt;p&gt;GridCellImage&lt;/p&gt;

&lt;p&gt;IdentifyDialog&lt;/p&gt;

&lt;p&gt;InsertEntityDialog&lt;/p&gt;

&lt;p&gt;MyRowGroup&lt;/p&gt;

&lt;p&gt;TableDialog&lt;/p&gt;

&lt;p&gt;AutoSaveDialog&lt;/p&gt;

&lt;p&gt;###MapView.cpp&lt;br/&gt;
MapView &amp;amp;&amp;amp; MyTipWindow&lt;/p&gt;

&lt;p&gt;###Shapefiles.cpp&lt;br/&gt;
MyFrame&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>编译spatialite-GIS</title>
   <link href="http://tom.preston-werner.com/2011/10/24/compilespatialite.html"/>
   <updated>2011-10-24T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/10/24/compilespatialite</id>
   <content type="html">&lt;h2&gt;编译spatialite-GIS&lt;/h2&gt;

&lt;p&gt;在ubuntugis包中的libspatialite-dev使用的是2.4.0-rc4-2，然而如果要编译&lt;br/&gt;
spatialite-GIS,需要librasterlite，而librasterlite的编译依赖libspatialite-dev，且必须在2.3.1稳定版本中才行。&lt;br/&gt;
否则会出现诸如：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;rasterlite_load.c:896:27: error: ‘GAIA_WAVELET_BLOB’ undeclared (first use in this function) &lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;的错误。另外在Debian/Ubuntu 包中libspatialite依赖的proj和geos位置并不一定是 ./configure 后默认的/usr/local/lib（我的是/usr/lib，可以搜索/usr看看你的是在什么地方）,&lt;br/&gt;
不止lib位置，include位置也略有不同。例如&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#579&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;&amp;lt;geotiff.h&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;需要改为&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#579&quot;&gt;#include&lt;/span&gt; &lt;span style=&quot;color:#B44;font-weight:bold&quot;&gt;&amp;lt;geotiff/geotiff.h&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;总之，在make时遇到“不存在文件或路径”这样的错误时就在/usr下搜索，看其具体位置再引用。&lt;br/&gt;
以上在google group邮件列表中也有说明：&lt;a href=&quot;http://groups.google.com/group/spatialite-users/browse_thread/thread/2916d001ec7ed776&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://groups.google.com/group/spatialite-users/browse_thread/thread/2916d001ec7ed776&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;还有就是源文件中这一句代码是错的，&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    &lt;span style=&quot;color:#088;font-weight:bold&quot;&gt;void&lt;/span&gt; ZoomTo(&lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; minx, &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; minx, &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; maxx, &lt;span style=&quot;color:#0a5;font-weight:bold&quot;&gt;double&lt;/span&gt; maxy);
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;修改第二个minx为miny就可以了。&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ubuntu 环境配置</title>
   <link href="http://tom.preston-werner.com/2011/10/10/myubuntuinit.html"/>
   <updated>2011-10-10T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/10/10/myubuntuinit</id>
   <content type="html">&lt;h2&gt;ubuntu init&lt;/h2&gt;

&lt;p&gt;最近重新安装了系统，配置ubuntu很麻烦，把所需的都记录下来，不用每次都看别人的：&lt;/p&gt;

&lt;h3&gt;1 安装git&lt;/h3&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo apt-get install git-core git-gui git-doc
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;ssh-keygen -t rsa -C &amp;quot;shiyj.cn@gmail.com&amp;quot;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;把id_rsa.pub内容加入到github中。&lt;/p&gt;

&lt;h3&gt;2 c/c++开发环境&lt;/h3&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo apt-get  install  build-essential&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;####安装ide Code::Blocks及图形界面wxwidgets&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo apt-get install build-essential
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;sudo apt-get install codeblocks-contrib
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;sudo apt-get install libwxgtk2.8-dev&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;3 openssl&lt;/h3&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo apt-get install libssl-dev&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;4 编译 ruby所需的依赖&lt;/h3&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo apt-get install zlib1g-dev
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;sudo apt-get install libx11-dev&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;5 Ubuntu GIS源&lt;/h3&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;deb http://ppa.launchpad.net/ubuntugis/ppa/ubuntu lucid main 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;deb-src http://ppa.launchpad.net/ubuntugis/ppa/ubuntu lucid main &lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;6 php apache&lt;/h3&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo apt-get install apache2
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;sudo apt-get install php5
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;sudo apt-get install php5-dev &lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;修改apache默认目录：&lt;br/&gt;
    sudo vi /etc/apache2/sites-available/default&lt;/p&gt;

&lt;p&gt;新建一个测试文件： test.php&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;&amp;lt;?php phpinfo(); ?&amp;gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;7 mongodb及其图形工具——rockmongo&lt;/h3&gt;

&lt;h4&gt;初始化目录&lt;/h4&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo mkdir -p /data/db/
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;sudo chown `id -u` /data/db&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;安装rockmongo：&lt;/h4&gt;

&lt;p&gt;配置php_mongo&lt;br/&gt;&lt;br/&gt;
    sudo apt-get install php-pear &lt;br/&gt;
    sudo apt-get install libcurl3-openssl-dev&lt;br/&gt;
    sudo pecl install mongo&lt;br/&gt;
修改php配置：&lt;br/&gt;
    sudo vi /etc/php5/apache2/php.ini &lt;/p&gt;

&lt;p&gt;在其中添加如下内容：&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;extension=mongo.so&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;8 编译node.js。&lt;/h3&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;sudo apt-get install libexpat1-dev&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;h4&gt;npm安装&lt;/h4&gt;

&lt;h3&gt;9 wine中文配置&lt;/h3&gt;

&lt;h3&gt;10 PostgreSQL与pgAdmin III 配置&lt;/h3&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>software entropy</title>
   <link href="http://tom.preston-werner.com/2011/07/16/chapt1sec.html"/>
   <updated>2011-07-16T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/07/16/chapt1sec</id>
   <content type="html">&lt;h3&gt;1.2 Software Entropy&lt;/h3&gt;

&lt;p&gt;while software development is immune from almost all physical laws, entropy hits us head.&lt;br/&gt;
Entropy is a term frome physics that refers to the amount of &amp;quot;disorder&amp;quot; in a system. Unfortunately, the law of thermodynamics guarantee that the &lt;br/&gt;
entropy in the universe tends toward a maximum. When disorder increase in software, programmers called it &amp;quot;software rot&amp;quot;.&lt;/p&gt;

&lt;p&gt;There are many factors that can contribute to software rot. The most important one seems to be the psychology, or culture, at work on a project.&lt;/p&gt;

&lt;p&gt;In inner cities, some building are beautiful and clean, while others are rotting hulks. Why? Researchers in the field of crime and urban decay discovered a fascinating trigger mechanism, one that &lt;br/&gt;
very quickly turns a clean, intact, inhabited building into a smashed and abandoned derelict.&lt;/p&gt;

&lt;h4&gt;A broken windows&lt;/h4&gt;

&lt;p&gt;one broken window, left unrepaired for any substantial length of time,instills in the inhabitants of the building a sense of abandonment--a sense that the powers that don&amp;#39;t care about the building.So &lt;br/&gt;
another windows gets broken. People start littering.In a relatively short space of time, the building becomes demaged beyond the oner&amp;#39;s desire to fix it,and the sense of abandonment becomes reality.&lt;/p&gt;

&lt;p&gt;Don&amp;#39;t leave &amp;quot;broken windows&amp;quot; (bed designs,wrong decisions,or poor code) unrepaired.Fix each one as soon as it is discovered.Perhaps you can comment out the offending code,or display a &amp;quot;Not Implemented&amp;quot;&lt;br/&gt;
 message ,or substitute dummy data instead. Take some action to prevent further damage and to show that you&amp;#39;re on top of the situation.&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>A Pragmatic Philosophy</title>
   <link href="http://tom.preston-werner.com/2011/05/16/chapt1.html"/>
   <updated>2011-05-16T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/05/16/chapt1</id>
   <content type="html">&lt;h2&gt;Chapter 1&lt;/h2&gt;

&lt;h3&gt;A Pragmatic Philosophy&lt;/h3&gt;

&lt;p&gt;What distinguishes Pragmatic Programmers? We feel it&amp;#39;s an attitude,a style,a philosophy of approaching problems and their solutions . They think&lt;br/&gt;
 beyond the immediate problems , always trying to place it in its larger context, always trying be aware of the bigger picture .&lt;/p&gt;

&lt;p&gt;Pragmatic programming stems from a philosophy of pragmatic thinking! &lt;/p&gt;

&lt;h3&gt;1.1 The cat ate my source code ?!&lt;/h3&gt;

&lt;p&gt;A pragmatic programmer takes charge of his or her own career, and isn&amp;#39;t afraid to admit ignorance or error.&lt;br/&gt;
 We can be proud of our abilities, but we must be honest about our shortcomings--our ignorance as well as our  mistakes.&lt;/p&gt;

&lt;p&gt;so remmeber that :&lt;/p&gt;

&lt;p&gt;The greatest of all weakness is the fear of appearing weak.&lt;/p&gt;

&lt;p&gt;Provide Options, Don&amp;#39;t Make Lame Excuses.&lt;br/&gt;
 Before you go and tell your boss or someone else why something can&amp;#39;t be dan,is late,or is broken,stop and ask yourself: is there anything else you can try? &lt;br/&gt;
 Sometimes,you just know what they are goning to say, so save them the trouble.&lt;/p&gt;

&lt;p&gt;Don&amp;#39;t say it can&amp;#39;t be done; explain what can be done to salvage the situation. Does code have to be throw out?&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>tar.gz 文件打开失败.</title>
   <link href="http://tom.preston-werner.com/2011/05/03/targz.html"/>
   <updated>2011-05-03T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/05/03/targz</id>
   <content type="html">&lt;p&gt;从网站上下载的 a.tar.gz 文件打开时提示:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;gzip: stdin: not in gzip format 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;tar: Child returned status 1 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;tar: Exiting with failure status due to previous errors&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;格式错误,使用file命令查看,显示如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;file a.tar.gz
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;bzip2 compressed data ,block = 900k&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;使用如下命令即可:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;bunzip2 a.tar.gz&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>ruby中taint对象污染机制</title>
   <link href="http://tom.preston-werner.com/2011/04/29/taint.html"/>
   <updated>2011-04-29T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/04/29/taint</id>
   <content type="html">&lt;p&gt;ruby中的对象调用taint方法将其设置成&amp;quot;污染&amp;quot;的.如果一个对象被设置为taint,那么源自它的所以对象都被设置为taint了.&lt;br/&gt;
在举例子之前先要说明下:类本身也是一个对象,是具有创建新对象能力的对象.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#B06;font-weight:bold&quot;&gt;FileLoader&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;   &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;load&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;     &lt;span style=&quot;color:#33B&quot;&gt;@obj&lt;/span&gt;=&lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;2011-04-26-tt.txt&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;       text =&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;File&lt;/span&gt;.read(&lt;span style=&quot;color:#33B&quot;&gt;@obj&lt;/span&gt;)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;     &lt;span style=&quot;color:#069&quot;&gt;self&lt;/span&gt;.taint
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;     puts text
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;   &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;   &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;putout&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;       str=&lt;span style=&quot;color:#069&quot;&gt;self&lt;/span&gt;.tainted? ?  &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;load successfull!&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; :  &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;load faild!&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;       puts str
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;   &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;  fl1=&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;FileLoader&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;  fl1.load
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;  fl1.putout &lt;span style=&quot;color:#777&quot;&gt;#load successfull!&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;  fl2=&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;FileLoader&lt;/span&gt;.new
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;  fl2.putout &lt;span style=&quot;color:#777&quot;&gt;#load faild!&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;说明:tainted?是用?方法来返回true or false,第二个?是三目运算符.&lt;/p&gt;

&lt;p&gt;上边例子说明污染机制通俗地说就是一个&amp;quot;标记&amp;quot;.将某个值和状态改变后把整个对象标记为&amp;quot;污染&amp;quot;,然后它可以&amp;quot;传染&amp;quot;给由它生成的其他对象也都&amp;quot;被&amp;quot;污染了.&lt;/p&gt;

&lt;p&gt;当然有污染就有去除污染的方法.ruby还提供了untaint来&amp;quot;治疗&amp;quot;污染.具体使用方法不再赘述.&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>神奇的.gems</title>
   <link href="http://tom.preston-werner.com/2011/04/29/syntax.html"/>
   <updated>2011-04-29T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/04/29/syntax</id>
   <content type="html">&lt;p&gt;在heroku 中托管项目如何才能把自己所需要的gem包install了呢?&lt;br/&gt;
例如:在我们本机开发时需要用到 coderay和rake-codehighlighter这两个gem.那么直接使用 gem install coderay 和 gem install rack-codehighlighter 就行了.然后再在项目中使用&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;coderay&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;rack/codehighlighter&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;将这两个包加载到程序中就行了.可是部署到heroku中却出现问题:`gem&lt;em&gt;original&lt;/em&gt;require&amp;#39;: no such file to load -- coderay (LoadError),如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]: /usr/ruby1.8.7/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require': no such file to load -- coderay (LoadError)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from config.ru:5
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /home/heroku_rack/heroku.ru:23
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:29:in `instance_eval'
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:29:in `initialize'
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:46:in `new'
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:46:in `map'
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /home/heroku_rack/heroku.ru:18
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:29:in `instance_eval'
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:29:in `initialize'
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;    2011-04-30T02:13:37+00:00 app[web.1]:   from /home/heroku_rack/heroku.ru:11:in `new'&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;原来在本地安装了并不一定在heroku中也安装.google了一下,发现了一个神奇的文件 : .gems&lt;/p&gt;

&lt;p&gt;.gems文件可以告诉heroku你要安装那些文件.具体实现方法:&lt;/p&gt;

&lt;p&gt;在项目的根目录下应该有一个隐藏文件 .gems文件,没有的话新建一个.然后在里边输入需要install的gem包.我的如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;builder
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;rdiscount
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;toto
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;coderay
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;rack-codehighlighter&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;当然后边还有一些其他选项,具体可以参考这里:&lt;a href=&quot;http://devcenter.heroku.com/articles/gemmanifest&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://devcenter.heroku.com/articles/gemmanifest&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;然后用git命令将其push到heroku上.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;git add .gems
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;git commit -m &amp;quot;add gems&amp;quot;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;git push heroku master&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;运行结果如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;Counting objects: 8, done.
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;Delta compression using up to 2 threads.
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    Compressing objects: 100% (6/6), done.
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;    Writing objects: 100% (6/6), 563 bytes, done.
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;    Total 6 (delta 2), reused 0 (delta 0)
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;    -----&amp;gt; Heroku receiving push
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;    -----&amp;gt; Rack app detected
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n10&quot; name=&quot;n10&quot;&gt;10&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;    -----&amp;gt; Installing gem builder from http://rubygems.org
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n11&quot; name=&quot;n11&quot;&gt;11&lt;/a&gt;&lt;/span&gt;               Successfully installed builder-3.0.0
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n12&quot; name=&quot;n12&quot;&gt;12&lt;/a&gt;&lt;/span&gt;               1 gem installed
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n13&quot; name=&quot;n13&quot;&gt;13&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n14&quot; name=&quot;n14&quot;&gt;14&lt;/a&gt;&lt;/span&gt;    -----&amp;gt; Installing gem rdiscount from http://rubygems.org
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n15&quot; name=&quot;n15&quot;&gt;15&lt;/a&gt;&lt;/span&gt;               Building native extensions.  This could take a while...
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n16&quot; name=&quot;n16&quot;&gt;16&lt;/a&gt;&lt;/span&gt;               Successfully installed rdiscount-1.6.8
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n17&quot; name=&quot;n17&quot;&gt;17&lt;/a&gt;&lt;/span&gt;               1 gem installed
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n18&quot; name=&quot;n18&quot;&gt;18&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n19&quot; name=&quot;n19&quot;&gt;19&lt;/a&gt;&lt;/span&gt;    -----&amp;gt; Installing gem toto from http://rubygems.org
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n20&quot; name=&quot;n20&quot;&gt;20&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;               Successfully installed toto-0.4.9
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n21&quot; name=&quot;n21&quot;&gt;21&lt;/a&gt;&lt;/span&gt;               1 gem installed
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n22&quot; name=&quot;n22&quot;&gt;22&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n23&quot; name=&quot;n23&quot;&gt;23&lt;/a&gt;&lt;/span&gt;    -----&amp;gt; Installing gem coderay from http://rubygems.org
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n24&quot; name=&quot;n24&quot;&gt;24&lt;/a&gt;&lt;/span&gt;               Successfully installed coderay-0.9.7
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n25&quot; name=&quot;n25&quot;&gt;25&lt;/a&gt;&lt;/span&gt;               1 gem installed
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n26&quot; name=&quot;n26&quot;&gt;26&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n27&quot; name=&quot;n27&quot;&gt;27&lt;/a&gt;&lt;/span&gt;    -----&amp;gt; Installing gem rack-codehighlighter from http://rubygems.org
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n28&quot; name=&quot;n28&quot;&gt;28&lt;/a&gt;&lt;/span&gt;               Building native extensions.  This could take a while...
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n29&quot; name=&quot;n29&quot;&gt;29&lt;/a&gt;&lt;/span&gt;               Successfully installed nokogiri-1.4.4
&lt;span class=&quot;line-numbers&quot;&gt;&lt;strong&gt;&lt;a href=&quot;#n30&quot; name=&quot;n30&quot;&gt;30&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;               Successfully installed rack-codehighlighter-0.4.7
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n31&quot; name=&quot;n31&quot;&gt;31&lt;/a&gt;&lt;/span&gt;               2 gems installed
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n32&quot; name=&quot;n32&quot;&gt;32&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n33&quot; name=&quot;n33&quot;&gt;33&lt;/a&gt;&lt;/span&gt;               Compiled slug size is 2.5MB
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n34&quot; name=&quot;n34&quot;&gt;34&lt;/a&gt;&lt;/span&gt;    -----&amp;gt; Launching... done
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n35&quot; name=&quot;n35&quot;&gt;35&lt;/a&gt;&lt;/span&gt;               http://shiyj.heroku.com deployed to Heroku
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n36&quot; name=&quot;n36&quot;&gt;36&lt;/a&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n37&quot; name=&quot;n37&quot;&gt;37&lt;/a&gt;&lt;/span&gt;    To git@heroku.com:shiyj.git
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n38&quot; name=&quot;n38&quot;&gt;38&lt;/a&gt;&lt;/span&gt;         f8fa0b1..a1f41c9  master -&amp;gt; master&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;再次刷新,程序可以运行了.&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>heroku中添加公钥</title>
   <link href="http://tom.preston-werner.com/2011/04/28/herokukey.html"/>
   <updated>2011-04-28T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/04/28/herokukey</id>
   <content type="html">&lt;p&gt;重装系统或在更换ssh keys时总是遇到出问题的事情如:&lt;br/&gt;
    Permission denied (publickey)&lt;br/&gt;
每次都重新生成阿啥的,结果忘记把keys给添加上.代码如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;    $ heroku keys:add
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;    Found existing public key: /home/engin/.ssh/id_rsa.pub
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;    Uploading SSH public key /home/engin/.ssh/id_rsa.pub
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;heroku是通过ssh key来识别用户的。通过命令 &lt;code&gt;heroku keys&lt;/code&gt;可以查看服务器中&lt;br/&gt;
所存储的ssh key(前提是要已经登录).&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;$ heroku keys
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;=== 7 keys for shiyj.cn@gmail.com
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;ssh-rsa AAAAB3NzaC...se9DgABQ== engin@ubuntu
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;ssh-rsa AAAAB3NzaC...LtWF7aKw== engin@ubuntu
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;ssh-rsa AAAAB3NzaC...Fw8dkjDw== engin@ubuntu
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;ssh-rsa AAAAB3NzaC...+8n4FbDQ== shiyj.cn@gmail.com
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;ssh-rsa AAAAB3NzaC...F72T9zMQ== shiyj.cn@gmail.com
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;ssh-rsa AAAAB3NzaC...e0F+eigQ== shiyj.cn@gmail.com
&lt;span class=&quot;line-numbers&quot;&gt; &lt;a href=&quot;#n9&quot; name=&quot;n9&quot;&gt;9&lt;/a&gt;&lt;/span&gt;ssh-rsa AAAAB3NzaC...S2CKfOtw== shiyj.cn@gmail.com&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;如果以前的ssh key不使用了(比如电脑丢了),可以将其删除,使用命令&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;$ heroku keys:remove shiyj.cn@gmail.com
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;Key shiyj.cn@gmail.com removed.&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>heroku Application Error</title>
   <link href="http://tom.preston-werner.com/2011/04/28/herokuerr.html"/>
   <updated>2011-04-28T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/04/28/herokuerr</id>
   <content type="html">&lt;p&gt;将代码push到heroku中后出现下面错误:&lt;/p&gt;

&lt;h2&gt;Application Error&lt;/h2&gt;

&lt;p&gt;An error occurred in the application and your page could not be served. Please try again in a few moments.&lt;/p&gt;

&lt;p&gt;If you are the application owner, check your logs for details.&lt;/p&gt;

&lt;p&gt;可以使用命令:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;heroku logs&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;查看具体到问题.&lt;br/&gt;
查看日志如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;        /usr/ruby1.8.7/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require': no such file to load -- coderay (LoadError)
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;        2011-04-29T08:44:52+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;        2011-04-29T08:44:52+00:00 app[web.1]:   from config.ru:4
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;        2011-04-29T08:44:52+00:00 app[web.1]:   from /home/heroku_rack/heroku.ru:23
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;        2011-04-29T08:44:52+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:29:in `instance_eval'
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;        2011-04-29T08:44:52+00:00 app[web.1]:   from /usr/ruby1.8.7/lib/ruby/gems/1.8/gems/rack-1.0.1/lib/rack/builder.rb:29:in `initialize'
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;注意第三行: from config.ru:4&lt;/p&gt;

&lt;p&gt;这是问题所在.查看源代码如下:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;  require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;toto&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;  require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;extends&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#777&quot;&gt;# Syntax Highlighting&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n4&quot; name=&quot;n4&quot;&gt;4&lt;/a&gt;&lt;/span&gt;  require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;coderay&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n5&quot; name=&quot;n5&quot;&gt;5&lt;/a&gt;&lt;/span&gt;  require &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;rack/codehighlighter&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n6&quot; name=&quot;n6&quot;&gt;6&lt;/a&gt;&lt;/span&gt;  use &lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Rack&lt;/span&gt;::&lt;span style=&quot;color:#036;font-weight:bold&quot;&gt;Codehighlighter&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:coderay&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:markdown&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n7&quot; name=&quot;n7&quot;&gt;7&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#A60&quot;&gt;:theme&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;active4d&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:lines&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:element&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(0,100%,50%,0.05)&quot;&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;pre&amp;gt;code&lt;/span&gt;&lt;span style=&quot;color:#710&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;, 
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n8&quot; name=&quot;n8&quot;&gt;8&lt;/a&gt;&lt;/span&gt;      &lt;span style=&quot;color:#A60&quot;&gt;:pattern&lt;/span&gt; =&amp;gt; &lt;span style=&quot;background-color:hsla(300,100%,50%,0.06)&quot;&gt;&lt;span style=&quot;color:#404&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;\A&lt;/span&gt;&lt;span style=&quot;color:#808&quot;&gt;:::(&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;\w&lt;/span&gt;&lt;span style=&quot;color:#808&quot;&gt;+)&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;\s&lt;/span&gt;&lt;span style=&quot;color:#808&quot;&gt;*(&lt;/span&gt;&lt;span style=&quot;color:#D20&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#808&quot;&gt;|&amp;amp;#x000A;)&lt;/span&gt;&lt;span style=&quot;color:#404&quot;&gt;/&lt;/span&gt;&lt;/span&gt;, &lt;span style=&quot;color:#A60&quot;&gt;:logging&lt;/span&gt; =&amp;gt; &lt;span style=&quot;color:#069&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;第四行是 require &amp;#39;coderay&amp;#39;.说明coderay库加载有问题.将其注释掉即可.&lt;/p&gt;

&lt;p&gt;可是为什么会出现这个问题呢?难道heroku找不到coderay这个库吗?请看&lt;a href=&quot;/2011/04/29/syntax/&quot; title=&quot;神奇的.gems&quot;&gt;这里:神奇的.gems&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Agent admitted failure to sign using the key</title>
   <link href="http://tom.preston-werner.com/2011/04/28/git.html"/>
   <updated>2011-04-28T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/04/28/git</id>
   <content type="html">&lt;p&gt;使用:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;ssh-keygen -t rsa -C &amp;quot;your_email@youremail.com&amp;quot;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;产生出 id&lt;em&gt;rsa, id&lt;/em&gt;rsa.pub, 后用    ssh git@github.com    连线时却出现下述讯息:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;Agent admitted failure to sign using the key
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;Permission denied (publickey).&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;解法&lt;/p&gt;

&lt;p&gt;于自己的机器上, 执行 ssh-add, 会出现下述讯息.&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;Identity added: /home/user/.ssh/id_rsa (/home/user/.ssh/id_rsa)&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;再次连线就正常了~&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;PTY allocation request failed on channel 0
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;Hi shiyj! You've successfully authenticated, but GitHub does not provide shell access.
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;Connection to github.com closed.&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>中文标题</title>
   <link href="http://tom.preston-werner.com/2011/04/26/tt.html"/>
   <updated>2011-04-26T00:00:00+08:00</updated>
   <id>http://tom.preston-werner.com/2011/04/26/tt</id>
   <content type="html">&lt;p&gt;新的标题.&lt;/p&gt;

&lt;h2&gt;井号作用&lt;/h2&gt;

&lt;h1&gt;然后?&lt;/h1&gt;

&lt;h3&gt;三个试试是啥.&lt;/h3&gt;

&lt;h4&gt;四个试试是啥.&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;http://www.google.com&quot; title=&quot;google&quot;&gt;google&lt;/a&gt; is a website.&lt;/p&gt;

&lt;p&gt;url有点麻烦啊&lt;a href=&quot;http://www.google.com&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;http://www.google.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;还应该有排版,一个空格和回车真的有这么大作用啊:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;a

&lt;ul&gt;
&lt;li&gt;aa&lt;/li&gt;
&lt;li&gt;ab&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;b

&lt;ul&gt;
&lt;li&gt;ba&lt;/li&gt;
&lt;li&gt;bb&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;c

&lt;ul&gt;
&lt;li&gt;ca&lt;/li&gt;
&lt;li&gt;cb

&lt;ul&gt;
&lt;li&gt;cba&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;其实代码还有另一种写法(四个空格):&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;abcdefghijklmn史英建&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;ruby代码:&lt;/p&gt;
&lt;div class=&quot;CodeRay&quot;&gt;
  &lt;div class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n1&quot; name=&quot;n1&quot;&gt;1&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#06B;font-weight:bold&quot;&gt;a&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n2&quot; name=&quot;n2&quot;&gt;2&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#777&quot;&gt;#aaa中文&lt;/span&gt;
&lt;span class=&quot;line-numbers&quot;&gt;&lt;a href=&quot;#n3&quot; name=&quot;n3&quot;&gt;3&lt;/a&gt;&lt;/span&gt;  &lt;span style=&quot;color:#080;font-weight:bold&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;

&lt;p&gt;Powered by &lt;a href=&quot;/about&quot;&gt;Engin&lt;/a&gt; &amp;amp; toto&lt;/p&gt;
</content>
 </entry>
 
 
</feed>